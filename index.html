<!DOCTYPE html>
<html>
<head>
    <title>Controller Documents 1.0</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
     -->
    <script src='//www.w3.org/Tools/respec/respec-w3c' class='remove'></script>
    <script class='remove' src="./common.js"></script>

    <script type="text/javascript" class="remove">
      var respecConfig = {
          // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
          specStatus:           "ED",

          // the specification's short name, as in http://www.w3.org/TR/short-name/
          shortName:            "controller-document",

          // subtitle
          //subtitle: "Controller Documents",

          // if you wish the publication date to be other than today, set this
          //publishDate:  "2024-05-23",

          // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
          // and its maturity status
          // previousPublishDate:  "1977-03-15",
          // previousMaturity:  "WD",

          // if there a publicly available Editor's Draft, this is the link
          edDraftURI:           "https://w3c.github.io/controller-document/",

          // if this is a LCWD, uncomment and set the end of its review period
          //implementationReportURI: "https://w3c.github.io/vc-data-integrity/implementations/",
          //crEnd: "2024-01-07",

          // if you want to have extra CSS, append them to this list
          // it is recommended that the respec.css stylesheet be kept
          //extraCSS:             ["spec.css", "prettify.css"],

          // editors, add as many as you like
          // only "name" is required
          editors: [{
            name: "Manu Sporny", url: "https://digitalbazaar.com/",
            company: "Digital Bazaar", companyURL: "http://digitalbazaar.com/",
            w3cid: 41758
          }, { name: "Michael B. Jones", url: "https://self-issued.info/",
            company: "independent",
            w3cid: 38745}],

          // authors, add as many as you like.
          // This is optional, uncomment if you have authors as well as editors.
          // only "name" is required. Same format as editors.

          authors: [
            {
              name: "Dave Longley",
              url: "http://digitalbazaar.com/",
              company: "Digital Bazaar",
              companyURL: "http://digitalbazaar.com/"
            },
            {
              name: "Manu Sporny",
              url: "http://digitalbazaar.com/",
              company: "Digital Bazaar",
              companyURL: "http://digitalbazaar.com/"
            },
            {
              name: "Markus Sabadello",
              url: "https://www.linkedin.com/in/markus-sabadello-353a0821",
              company: "Danube Tech",
              companyURL: "https://danubetech.com/",
              w3cid: 46729
            },
            {
              name: "Drummond Reed",
              url: "https://www.linkedin.com/in/drummondreed/",
              company: "Evernym/Avast",
              companyURL: "https://www.evernym.com/",
              w3cid: 3096
            },
            {
              name: "Orie Steele",
              url: "https://www.linkedin.com/in/or13b/",
              company: "Transmute",
              companyURL: "https://transmute.industries/"
            },
            {
              name: "Christopher Allen",
              url: "https://www.linkedin.com/in/christophera",
              company: "Blockchain Commons",
              companyURL: "https://www.BlockchainCommons.com",
              w3cid: 85560
            }
          ],

          // extend the bibliography entries
          //localBiblio: webpayments.localBiblio,

          // name of the WG
          group:           "vc",

          // name (with the @w3c.org) of the public mailing to which comments are due
          wgPublicList: "public-vc-wg",

          github: "w3c/controller-document",

          // URI of the patent status for this WG, for Rec-track documents
          // !!!! IMPORTANT !!!!
          // This is important for Rec-track documents, do not copy a patent URI from a random
          // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
          // Team Contact.
          //wgPatentURI:  "",
          xref: ["URL", "I18N-GLOSSARY", "INFRA", "?VC-DATA-MODEL-2.0"],
          maxTocLevel: 3,
          /*preProcess: [ ],
          alternateFormats: [ {uri: "diff-20111214.html", label: "diff to previous version"} ],
          */
          localBiblio:  {
            "DI-EDDSA": {
              title:    "The Edwards Digital Signature Algorithm Cryptosuites v1.0",
              href:     "https://www.w3.org/TR/vc-di-eddsa/",
              authors:  ["David Longley", "Manu Sporny", "Dmitri Zagidulin"],
              status:   "WD",
              publisher:  "W3C Verifiable Credentials Working Group"
            },
            "DI-ECDSA": {
              title:    "The Elliptic Curve Digital Signature Algorithm Cryptosuites v1.0",
              href:     "https://www.w3.org/TR/vc-di-ecdsa/",
              authors:  ["David Longley", "Manu Sporny", "Marty Reed"],
              status:   "WD",
              publisher:  "W3C Verifiable Credentials Working Group"
            },
            "DI-BBSDSA": {
              title:    "The BBS Digital Signature Algorithm Cryptosuites v1.0",
              href:     "https://www.w3.org/TR/vc-di-bbs/",
              authors:  ["Tobias Looker", "Orie Steele"],
              status:   "WD",
              publisher:  "W3C Verifiable Credentials Working Group"
            },
            "JOSE-REGISTRIES": {
              title:    "The JSON Object Signing and Encryption (JOSE) Registries",
              href:     "https://www.iana.org/assignments/jose",
              authors:  ["The Internet Assigned Numbers Authority"],
              status:   "REC",
              publisher:  "The Internet Assigned Numbers Authority"
            },
            "SECURITY-VOCABULARY": {
              title:    "The Security Vocabulary",
              href:     "https://w3id.org/security",
              authors:  ["Ivan Herman", "Manu Sporny","David Longley"],
              status:   "ED",
              publisher:  "Verifiable Credentials Working Group"
            },
            "ZCAP": {
              title:    "Authorization Capabilities for Linked Data",
              href:     "https://w3c-ccg.github.io/zcap-spec/",
              status:   "CGDRAFT",
              publisher:  "Credentials Community Group"
            },
            "MULTIBASE": {
              title: "The Multibase Data Format",
              date: "February 2023",
              href: "https://datatracker.ietf.org/doc/draft-multiformats-multibase",
              authors: [
                "Juan Benet",
                "Manu Sporny"
              ],
              status: "Internet-Draft",
              publisher: "IETF"
            },
            "MULTIHASH": {
              title: "The Multihash Data Format",
              date: "February 2023",
              href: "https://datatracker.ietf.org/doc/draft-multiformats-multihash",
              authors: [
                "Juan Benet",
                "Manu Sporny"
              ],
              status: "Internet-Draft",
              publisher: "IETF"
            },
            "MULTICODEC": {
              title: "The Multi Codec Encoding Scheme",
              date: "February 2022",
              href: "https://github.com/multiformats/multicodec/blob/master/table.csv",
              authors: [
                "The Multiformats Community"
              ],
              status: "Internet-Draft",
              publisher: "IETF"
            },
            "VC-SPECS": {
              title: "Verifiable Credential Specifications Directory",
              href: "https://w3c.github.io/vc-specs-dir/",
              authors: [
                "Manu Sporny"
              ],
              status: "ED",
              publisher: "W3C Verifiable Credentials Working Group"
            },
            "DID-KEY": {
              title: "The did:key Method",
              href: "https://w3c-ccg.github.io/did-method-key/",
              authors: [
                "Manu Sporny",
                "Dmitri Zagidulin",
                "Dave Longley",
                "Orie Steele"
              ],
              status: "CG-DRAFT",
              publisher: "W3C Credentials Community Group"
            },
            "SHA3": {
              title: "SHA-3 Standard: Permutation-Based Hash and Extendable-Output Functions",
              href: "https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf",
              authors: [
                "National Institute of Standards and Technology",
              ],
              status: "National Standard",
              publisher: "U.S. Department of Commerce"
            },
            "SD-JWT": {
              title:    "Selective Disclosure for JWTs (SD-JWT)",
              href:     "https://datatracker.ietf.org/doc/draft-ietf-oauth-selective-disclosure-jwt/",
              authors: [
                "Daniel Fett",
                "Kristina Yasuda",
                "Brian Campbell"
              ],
              status:   "I-D",
              publisher:  "The IETF OAuth Working Group"
            }
          },
          postProcess: [],
          otherLinks: [{
            key: "Related Specifications",
            data: [{
              value: "Decentralized Identifiers v1.0",
              href: "https://www.w3.org/TR/did-core/"
            }, {
              value: "The Verifiable Credentials Data Model v2.0",
              href: "https://www.w3.org/TR/vc-data-model-2.0/"
            }, {
              value: "Data Integrity v1.0",
              href: "https://www.w3.org/TR/vc-data-integrity/"
            }, {
              value: "Securing Verifiable Credentials using JOSE and COSE",
              href: "https://www.w3.org/TR/vc-jose-cose/"
            }]
          }]
      };
    </script>
    <style>
code {
  color: rgb(199, 73, 0);
  font-weight: bold;
}
pre.nohighlight {
  overflow-x: auto;
  white-space: pre-wrap;
}
ol.algorithm { counter-reset:numsection; list-style-type: none; }
ol.algorithm li { margin: 0.5em 0; }
ol.algorithm li:before { font-weight: bold; counter-increment: numsection; content: counters(numsection, ".") ") "; }
    </style>
</head>
<body>
    <section id='abstract'>
      <p>
A <a>controller document</a> is a set of data that specifies one or more
relationships between a <a>controller</a> and a set of data, such as a set of
public cryptographic keys.
      </p>
    </section>

    <section id='sotd'>

    </section>

    <section class="informative">
      <h2>Introduction</h2>
      <p>
A <a>controller document</a> is a set of data that specifies one or more
relationships between a <a>controller</a> and a set of data, such as a set of
public cryptographic keys. The <a>controller document</a> SHOULD
contain <a>verification relationships</a> that explicitly permit the use of
certain <a>verification methods</a> for specific purposes.
      </p>
      <p>
It is expected that other specifications using this specification
will profile the features that it defines,
requiring and/or recommending the use of some and
prohibiting and/or deprecating the use of others.
      </p>
      <p>
It is expected that other specifications using this specification
will profile the features that it defines,
requiring and/or recommending the use of some and
prohibiting and/or deprecating the use of others.
      </p>

      <section id="conformance">
        <p>
A <dfn>conforming controller document</dfn> is any concrete expression of the
data model that follows the relevant normative requirements in Sections
<a href="#data-model"></a> and <a href="#contexts-and-vocabularies"></a>.
        </p>

        <p>
A <dfn>conforming verification method</dfn> is any concrete expression of the
data model that follows the relevant normative requirements in Sections
<a href="#verification-methods"></a> and
<a href="#contexts-and-vocabularies"></a>.
        </p>

        <p>
A <dfn class="lint-ignore">conforming document</dfn> is either a
<a>conforming controller document</a>, or a
<a>conforming verification method</a>.
        </p>

        <p>
A <dfn class="lint-ignore">conforming processor</dfn> is any algorithm realized
as software and/or hardware that generates and/or consumes a
<a>conforming document</a> according to the relevant normative statements in
Section <a href="#algorithms"></a>. Conforming processors MUST produce errors
when non-conforming documents are consumed.
        </p>

      </section>

      <section class="informative">
        <h3>Terminology</h3>

        <p>
This section defines the terms used in this specification. A link to these terms
is included whenever they appear in this specification.
        </p>

        <dl class="termlist definitions" data-sort="ascending">

          <dt><dfn>public key</dfn></dt>
          <dd>
Cryptographic material that can be used to verify digital proofs created with a
corresponding [=private key=].
          </dd>

          <dt><dfn>private key</dfn></dt>
          <dd>
Cryptographic material that can be used to generate digital proofs.
          </dd>

          <dt><dfn data-lt="authenticated|authenticate">authentication</dfn></dt>
          <dd>
A process by which an entity can prove to a verifier that it has a specific
attribute or controls a specific secret.
          </dd>

          <dt><dfn class="export" data-lt="cryptosuite">cryptographic suite</dfn></dt>
          <dd>
A specification defining the usage of specific cryptographic primitives in
order to achieve a particular security goal. These documents are often used
to specify [=verification methods=], digital signature types,
their identifiers, and other related properties.<!--  See Section -->
<!-- [[[#cryptographic-suites]]] for further detail. -->
          </dd>

          <dt><dfn class="export" data-lt="controller(s)">controller</dfn></dt>
          <dd>
An entity that has the capability to make changes to a
[=controller document=].
          </dd>

          <dt><dfn class="export" data-lt="controller documents">controller document</dfn></dt>
          <dd>
A set of data that specifies one or more relationships between a
[=controller=] and a set of data, such as a set of public cryptographic keys.
          </dd>

          <dt><dfn data-lt="subjects">subject</dfn></dt>
          <dd>
The entity identified by the `id` property in a [=controller document=].
Anything can be a subject: person, group, organization, physical thing, digital
thing, logical thing, etc.
          </dd>

          <dt><dfn class="export">verification method</dfn></dt>
          <dd>
            <p>
A set of parameters that can be used together with a process to independently
verify a proof. For example, a cryptographic public key can be used as a
verification method with respect to a digital signature; in such usage, it
verifies that the signer possessed the associated cryptographic private key.
            </p>
            <p>
"Verification" and "proof" in this definition are intended to apply broadly. For
example, a cryptographic public key might be used during Diffie-Hellman key
exchange to negotiate a shared symmetric key for encryption. This guarantees the
integrity of the key agreement process. It is thus another type of verification
method, even though descriptions of the process might not use the words
"verification" or "proof."
            </p>
          </dd>

          <dt><dfn class="export">verification relationship</dfn></dt>
          <dd>
            <p>
An expression of the relationship between the [=subject=] and a
[=verification method=]. An example of a verification relationship is
[[[#authentication]]].
            </p>
          </dd>

        </dl>

      </section>
    </section>

      <section>
        <h3>Data Model</h3>

        <p>
A <a>controller document</a> is a set of data that specifies one or more
relationships between a <a>controller</a> and a set of data, such as a set of
public cryptographic keys. The <a>controller document</a> SHOULD
contain <a>verification relationships</a> that explicitly permit the use of
certain <a>verification methods</a> for specific purposes.
        </p>

        <div class="issue">Add examples of common Controller documents, such as
controller documents published on a ledger-based registry, or on a mutable medium in
combination with an integrity protection mechanism such as Hashlinks.
        </div>

        <section>
          <h2>Verification Methods</h2>
          <p>
A <a>controller document</a> can express <a>verification methods</a>, such as
cryptographic <a>public keys</a>, which can be used to <a>authenticate</a> or
authorize interactions with the <a>controller</a> or associated parties. For
example, a cryptographic <a>public key</a> can be used as a <a>verification
method</a> with respect to a digital signature; in such usage, it verifies that
the signer could use the associated cryptographic private key. <a>Verification
methods</a> might take many parameters. An example of this is a set of five
cryptographic keys from which any three are required to contribute to a
cryptographic threshold signature.
          </p>

          <dl>
            <dt><dfn class="lint-ignore">verificationMethod</dfn></dt>
            <dd>
              <p>
The `verificationMethod` property is OPTIONAL. If present, the value
MUST be a <a data-cite="INFRA#ordered-set">set</a> of <a>verification
methods</a>, where each <a>verification method</a> is expressed using a <a
data-cite="INFRA#ordered-map">map</a>. The <a>verification method</a> <a
data-cite="INFRA#ordered-map">map</a> MUST include the `id`,
`type`, `controller`, and specific verification material
properties that are determined by the value of `type` and are defined
in <a href="#verification-material"></a>. A <a>verification method</a> MAY
include additional properties.
<!-- VC-DATA-INTEGRITY-SPECIFIC:
<a>Verification methods</a> SHOULD be registered
in the Data Integrity Specification Registries [TBD - DIS-REGISTRIES].
-->
              </p>

              <dl>
                <dt>id</dt>
                <dd>
                  <p>
The value of the `id` property for a <a>verification
method</a> MUST be a <a data-cite="INFRA#string">string</a> that conforms to the
conforms to the [[URL]] syntax.
                  </p>
                </dd>
                <dt>type</dt>
                <dd>
The value of the `type` property MUST be a <a
data-cite="INFRA#string">string</a> that references exactly one <a>verification
method</a> type.
<!-- VC-DATA-INTEGRITY-SPECIFIC:
In order to maximize global interoperability, the
<a>verification method</a> type SHOULD be registered in the Data Integrity Specification
Registries [TBD -- DIS-REGISTRIES].
-->
<!-- VC-JOSE-COSE-SPECIFIC:
To maximize interoperability, the
<a>verification method</a> type SHOULD be `JsonWebKey`.
-->
                </dd>
                <dt><span id="defn-controller">controller</span></dt>
                <dd>
The value of the `controller` property MUST be a <a
data-cite="INFRA#string">string</a> that conforms to the [[URL]] syntax.
                </dd>
<!-- VC-DATA-INTEGRITY-SPECIFIC:
                <dt id="defn-vm-expires">expires</dt>
                <dd>
The `expires` property is OPTIONAL. It is set, in advance, by the
<a>controller</a> of a  <a>verification method</a> to signal when that method
can no longer be used for verification purposes. If provided, it MUST be an
[[XMLSCHEMA11-2]] `dateTimeStamp` string specifying when the
<a>verification method</a> SHOULD cease to be used. Once the value is set, it is
not expected to be updated, and systems depending on the value are expected to
not verify any proofs associated with the <a>verification method</a> at or after
the time of expiration.
                </dd>
-->
                <dt><dfn class="lint-ignore">revoked</dfn></dt>
                <dd>
The `revoked` property is OPTIONAL.
<!-- VC-DATA-INTEGRITY-SPECIFIC:
It is set by the <a>controller</a> of a
<a>verification method</a> to signal when that method is to no longer to be used
for verification purposes, such as after a security compromise of the
<a>verification method</a>.
-->
If present, it MUST be an [[XMLSCHEMA11-2]]
`dateTimeStamp` string specifying when the <a>verification method</a>
SHOULD cease to be used. Once the value is set, it is not expected to be
updated, and systems depending on the value are expected to not verify any
proofs associated with the <a>verification method</a> at or after the time of
revocation.
                </dd>
              </dl>
            </dd>
          </dl>

          <pre class="example nohighlight"
            title="Example verification method structure">
    {
      "@context": [
        "https://www.w3.org/ns/did/v1",
        "https://www.w3.org/ns/credentials/v2",
        "https://w3id.org/security/jwk/v1",
        "https://w3id.org/security/data-integrity/v2"
      ]
      "id": "did:example:123456789abcdefghi",
      <span class="comment">...</span>
      "verificationMethod": [{
        "id": <span class="comment">...</span>,
        "type": <span class="comment">...</span>,
        "controller": <span class="comment">...</span>,
        "publicKeyJwk": <span class="comment">...</span>
      }, {
        "id": <span class="comment">...</span>,
        "type": <span class="comment">...</span>,
        "controller": <span class="comment">...</span>,
        "publicKeyMultibase": <span class="comment">...</span>
      }]
    }
          </pre>

          <p class="note"
            title="Verification method controller(s) and controller(s)">
The semantics of the `controller` property are the same when the
subject of the relationship is the <a>controller document</a> as when the subject of
the relationship is a <a>verification method</a>, such as a cryptographic public
key. Since a key can't control itself, and the key controller cannot be inferred
from the <a>controller document</a>, it is necessary to explicitly express the identity
of the controller of the key. The difference is that the value of
`controller` for a <a>verification method</a> is <em>not</em>
necessarily a <a>controller</a>. <a>controllers</a> are expressed
using the `<a>controller</a>` property at the highest level of the
<a>controller document</a>.
          </p>

          <section>
            <h3>Verification Material</h3>

            <p>
Verification material is any information that is used by a process that applies
a <a>verification method</a>. The `type` of a <a>verification method</a> is
expected to be used to determine its compatibility with such processes. Examples
of verification methods include `JsonWebKey` and `Multikey`.
A <a>cryptographic suite</a> specification is responsible for specifying the
<a>verification method</a> `type` and its associated verification material
format. For examples, see
<a href="https://www.w3.org/TR/vc-jose-cose/">Securing Verifiable Credentials using JOSE and COSE</a>,
<a href="https://www.w3.org/TR/vc-di-ecdsa/">the Data Integrity ECDSA
Cryptosuites</a> and <a href="https://w3c-ccg.github.io/lds-ed25519-2020/">
the Data Integrity EdDSA Cryptosuites</a>.
<!-- VC-DATA-INTEGRITY-SPECIFIC:
For a list of <a>verification
method</a> types, please see the [[?SECURITY-VOCABULARY]].
-->
            </p>

            <p>
To increase the likelihood of interoperable implementations, this specification
limits the number of formats for expressing verification material in a
<a>controller document</a>. The fewer formats that implementers have to
implement, the more likely it will be that they will support all of them. This
approach attempts to strike a delicate balance between easing implementation
and providing support for formats that have historically had broad deployment.
            </p>

            <p>
A <a>verification method</a> MUST NOT contain multiple verification material
properties for the same material. For example, expressing key material in a
<a>verification method</a> using both `publicKeyJwk` and
`publicKeyMultibase` at the same time is prohibited.
            </p>

            <p>
Implementations MAY convert keys between formats as desired for operational purposes or
to interface with cryptographic libraries. As an internal implementation detail, such
conversion MUST NOT affect the external representation of key material.
            </p>

            <p>
An example of a <a>controller document</a> containing <a>verification
methods</a> using both properties above is shown below.
            </p>

            <pre id="example-various-verification-method-types"
              class="example nohighlight"
              title="Verification methods using publicKeyJwk and publicKeyMultibase">
    {
      "@context": [
        "https://www.w3.org/ns/did/v1",
        "https://www.w3.org/ns/credentials/v2",
        "https://w3id.org/security/jwk/v1",
        "https://w3id.org/security/multikey/v1"
      ]
      "id": "did:example:123456789abcdefghi",
      <span class="comment">...</span>
      "verificationMethod": [{
        "id": "did:example:123#_Qq0UL2Fq651Q0Fjd6TvnYE-faHiOpRlPVQcY_-tA4A",
        "type": "JsonWebKey", <span class="comment">// external (property value)</span>
        "controller": "did:example:123",
        "publicKeyJwk": {
          "crv": "Ed25519", <span class="comment">// external (property name)</span>
          "x": "VCpo2LMLhn6iWku8MKvSLg2ZAoC-nlOyPVQaO3FxVeQ", <span class="comment">// external (property name)</span>
          "kty": "OKP", <span class="comment">// external (property name)</span>
          "kid": "_Qq0UL2Fq651Q0Fjd6TvnYE-faHiOpRlPVQcY_-tA4A" <span class="comment">// external (property name)</span>
        }
      }, {
        "id": "did:example:123456789abcdefghi#keys-1",
        "type": "Multikey", <span class="comment">// external (property value)</span>
        "controller": "did:example:pqrstuvwxyz0987654321",
        "publicKeyMultibase": "z6MkmM42vxfqZQsv4ehtTjFFxQ4sQKS2w6WR7emozFAn5cxu"
      }],
      <span class="comment">...</span>
    }
            </pre>
          </section>

          <section>
            <h3>Multikey</h3>
            <p>
The Multikey data model is a specific type of <a>verification method</a> that
encodes key types into a single binary stream that is then encoded as a
Multibase value as described in Section <a href="#multibase-0"></a>.
            </p>

            <p>
When specifing a `Multikey`, the object takes the following form:
            </p>

            <dl>
              <dt>type</dt>
              <dd>
The value of the `type` property MUST contain the string `Multikey`.
              </dd>
              <dt><dfn class="lint-ignore">publicKeyMultibase</dfn></dt>
              <dd>
The `publicKeyMultibase` property is OPTIONAL. If present, its value MUST be a
Multibase encoded value as described in Section <a href="#multibase-0"></a>.
              </dd>
              <dt><dfn class="lint-ignore">secretKeyMultibase</dfn></dt>
              <dd>
The `secretKeyMultibase` property is OPTIONAL. If present, its value MUST be a
Multibase encoded value as described in Section <a href="#multibase-0"></a>.
              </dd>
            </dl>

            <p>
An example of a Multikey is provided below:
            </p>

            <pre class="example nohighlight"
              title="Multikey encoding of a Ed25519 public key">
{
  "@context": ["https://w3id.org/security/multikey/v1"],
  "id": "did:example:123456789abcdefghi#keys-1",
  "type": "Multikey",
  "controller": "did:example:123456789abcdefghi",
  "publicKeyMultibase": "z6MkmM42vxfqZQsv4ehtTjFFxQ4sQKS2w6WR7emozFAn5cxu"
}
            </pre>

            <p>
In the example above, the `publicKeyMultibase` value starts with the letter `z`,
which is the <a href="#multibase-0">Multibase</a> header that conveys that the
binary data is base-58-btc-encoded using the Bitcoin base-encoding alphabet. The
decoded binary data header is `0xed01`, which specifies that the
remaining data is a 32-byte raw Ed25519 <a>public key</a>.
            </p>

            <p>
The Multikey data model is also capable of encoding secret keys, whose subtypes
include <em>symmetric keys</em> and <em>private keys</em>.
            </p>

            <pre class="example nohighlight"
              title="Multikey encoding of a Ed25519 secret key">
{
  "@context": ["https://w3id.org/security/suites/secrets/v1"],
  "id": "did:example:123456789abcdefghi#keys-1",
  "type": "Multikey",
  "controller": "did:example:123456789abcdefghi",
  "secretKeyMultibase": "z3u2fprgdREFtGakrHr6zLyTeTEZtivDnYCPZmcSt16EYCER"
}
            </pre>

            <p>
In the example above, the `secretKeyMultibase` value starts with the letter `z`,
which is the <a href="#multibase-0">Multibase</a> header that conveys that the
binary data is base-58-btc-encoded using the Bitcoin base-encoding alphabet. The
decoded binary data header is `0x8026`, which specifies that the
remaining data is a 32-byte raw Ed25519 private key.
            </p>

          </section>

          <section>
            <h3>JsonWebKey</h3>
            <p>
The JSON Web Key (JWK) data model is a specific type of <a>verification method</a>
that uses the JWK specification [[RFC7517]] to encode key types into a
set of parameters.
            </p>

            <p>
When specifing a `JsonWebKey`, the object takes the following form:
            </p>

            <dl>
              <dt>type</dt>
              <dd>
The value of the `type` property MUST contain the string `JsonWebKey`.
              </dd>
              <dt><dfn class="lint-ignore">publicKeyJwk</dfn></dt>
              <dd>
                <p>
The `publicKeyJwk` property is OPTIONAL. If present, its value MUST
be a <a data-cite="INFRA#ordered-map">map</a> representing a JSON Web Key that
conforms to [[RFC7517]]. The <a data-cite="INFRA#ordered-map">map</a> MUST NOT
include any members of the private information class, such as `d`, as described
in the <a href="https://datatracker.ietf.org/doc/html/rfc7517#section-8.1.1">JWK
Registration Template</a>. It is RECOMMENDED that verification methods that use
JWKs [[RFC7517]] to represent their <a>public keys</a> use the value of `kid` as
their fragment identifier. It is RECOMMENDED that JWK `kid` values are set to
the public key fingerprint [[RFC7638]]. See the first key in
<a href="#example-various-verification-method-types"></a> for an example of a
public key with a compound key identifier.
                </p>
                <p>
As specified in <a data-cite="RFC7517#section-4.4">Section 4.4 of the JWK specification</a>,
the OPTIONAL `alg` property identifies the algorithm intended for use with the public key,
and SHOULD be included to prevent security issues that can arise when using the same
key with multiple algorithms. As specified in <a data-cite="RFC7518#section-6.2.1.1">
Section 6.2.1.1 of the JWA specification</a>, describing a key using an elliptic curve,
the REQUIRED `crv` property is used to identify the particular curve type of the public key.
As specified in <a data-cite="RFC7515#section-4.1.4">Section 4.1.4 of the JWS specification</a>,
the OPTIONAL `kid` property is a hint used to help discover the key; if present, the `kid` value SHOULD
match, or be included in, the `id` property of the encapsulating `JsonWebKey` object,
as part of the path, query, or fragment of the URL.
                </p>

              </dd>
              <dt><dfn class="lint-ignore">secretKeyJwk</dfn></dt>
              <dd>
The `secretKeyJwk` property is OPTIONAL. If present, its value MUST be a <a
data-cite="INFRA#ordered-map">map</a> representing a JSON Web Key that conforms
to [[RFC7517]].
It MUST NOT be used if the data structure containing it is public or may be revealed to parties other than the legitimate holders of the secret key.
              </dd>
            </dl>

            <p>
An example of an object that conforms to `JsonWebKey` is provided below:
            </p>

            <pre class="example nohighlight" title="JSON Web Key encoding of a secp384r1 (P-384) public key">
{
  "id": "did:example:123456789abcdefghi#key-1",
  "type": "JsonWebKey",
  "controller": "did:example:123456789abcdefghi",
  "publicKeyJwk": {
      "kid": "key-1",
      "kty": "EC",
      "crv": "P-384",
      "alg": "ES384",
      "x": "1F14JSzKbwxO-Heqew5HzEt-0NZXAjCu8w-RiuV8_9tMiXrSZdjsWqi4y86OFb5d",
      "y": "dnd8yoq-NOJcBuEYgdVVMmSxonXg-DU90d7C4uPWb_Lkd4WIQQEH0DyeC2KUDMIU"
    }
}
            </pre>

            <p>
In the example above, the `publicKeyJwk` value contains the JSON Web Key.
The `kty` property encodes the key type of "OKP", which means
"Octet string key pairs". The `alg` property identifies the algorithm intended
for use with the public key, which in this case is `ES384`. The `crv` property identifies
the particular curve type of the public key, `P-384`. The `x` property specifies
the point on the P-384 curve that is associated with the public key.
            </p>

            <p>
The `publicKeyJwk` property MUST NOT contain any property marked as
"Private" or "Secret" in any registry contained in the JOSE Registries [[JOSE-REGISTRIES]], including "d".
            </p>

            <p>
The JSON Web Key data model is also capable of encoding <em>secret keys</em>, sometimes
referred to as <em>private keys</em>.
            </p>

            <pre class="example nohighlight"
              title="JSON Web Key encoding of a secp384r1 (P-384) secret key">
{
  "id": "did:example:123456789abcdefghi#key-1",
  "type": "JsonWebKey",
  "controller": "did:example:123456789abcdefghi",
  "secretKeyJwk": {
      "kty": "EC",
      "crv": "P-384",
      "alg": "ES384",
      "d": "fGwges0SX1mj4eZamUCL4qtZijy9uT15fI4gKTuRvre4Kkoju2SHM4rlFOeKVraH",
      "x": "1F14JSzKbwxO-Heqew5HzEt-0NZXAjCu8w-RiuV8_9tMiXrSZdjsWqi4y86OFb5d",
      "y": "dnd8yoq-NOJcBuEYgdVVMmSxonXg-DU90d7C4uPWb_Lkd4WIQQEH0DyeC2KUDMIU"
    }
}
            </pre>

            <p>
The private key example above is almost identical to the previous example of the
public key, except that the information is stored in the `secretKeyJwk` property
(rather than the `publicKeyJwk`), and the private key value is encoded in the `d`
property thereof (alongside the `x` property, which still specifies the point on
the Ed25519 curve that is associated with the public key).
            </p>

          </section>

          <section>
            <h3>Referring to Verification Methods</h3>
            <p>
<a>Verification methods</a> can be embedded in or referenced from properties
associated with various <a>verification relationships</a> as described in <a
href="#verification-relationships"></a>. Referencing <a>verification methods</a>
allows them to be used by more than one <a>verification relationship</a>.
            </p>

            <p>
If the value of a <a>verification method</a> property is a <a
data-cite="INFRA#ordered-map">map</a>, the <a>verification method</a> has been
embedded and its properties can be accessed directly. However, if the value is a
URL <a data-cite="INFRA#string">string</a>, the <a>verification method</a> has
been included by reference and its properties will need to be retrieved from
elsewhere in the <a>controller document</a> or from another <a>controller document</a>. This
is done by dereferencing the URL and searching the resulting resource for a
<a>verification method</a> <a data-cite="INFRA#ordered-map">map</a> with an
`id` property whose value matches the URL.
            </p>

            <pre class="example nohighlight"
            title="Embedding and referencing verification methods">
    {
<span class="comment">...</span>

      "authentication": [
        <span class="comment">// this key is referenced and might be used by</span>
        <span class="comment">// more than one verification relationship</span>
        "did:example:123456789abcdefghi#keys-1",
        <span class="comment">// this key is embedded and may *only* be used for authentication</span>
        {
          "id": "did:example:123456789abcdefghi#keys-2",
          "type": "Multikey", <span class="comment">// external (property value)</span>
          "controller": "did:example:123456789abcdefghi",
          "publicKeyMultibase": "z6MkmM42vxfqZQsv4ehtTjFFxQ4sQKS2w6WR7emozFAn5cxu"
        }
      ],

<span class="comment">...</span>
    }
            </pre>
          </section>
        </section>

        <section>
          <h2>Verification Relationships</h2>

          <p>
A <a>verification relationship</a> expresses the relationship between the
<a>controller</a> and a <a>verification method</a>.
          </p>
          <p>
Different <a>verification relationships</a> enable the associated
<a>verification methods</a> to be used for different purposes. It is up to a
<em>verifier</em> to ascertain the validity of a verification attempt by
checking that the <a>verification method</a> used is contained in the
appropriate <a>verification relationship</a> property of the
<a>controller document</a>.
          </p>
          <p>
The <a>verification relationship</a> between the <a>controller</a> and the
<a>verification method</a> is explicit in the <a>controller document</a>.
<a>Verification methods</a> that are not associated with a particular
<a>verification relationship</a> cannot be used for that <a>verification
relationship</a>. For example, a <a>verification method</a> in the value of
the `<a>authentication</a>` property cannot be used to engage in
key agreement protocols with the <a>controller</a>&mdash;the value of the
`<a>keyAgreement</a>` property needs to be used for that.
          </p>
          <p>
The <a>controller document</a> does not express revoked keys using a <a>verification
relationship</a>. If a referenced verification method is not in the latest
<a>controller document</a> used to dereference it, then that verification method is
considered invalid or revoked.
          </p>
          <p>
The following sections define several useful <a>verification relationships</a>.
A <a>controller document</a> MAY include any of these, or other properties, to
express a specific <a>verification relationship</a>. To maximize global
interoperability, any such properties used SHOULD be registered in the
<a href="https://w3c.github.io/vc-specs-dir/#securing-mechanisms">VC Specifications Directory</a>.
          </p>

          <section>
            <h2>Authentication</h2>

            <p>
The `authentication` <a>verification relationship</a> is used to
specify how the <a>controller</a> is expected to be <a>authenticated</a>, for
purposes such as logging into a website or engaging in any sort of
challenge-response protocol.
            </p>

            <dl>
              <dt id="defn-authentication">authentication</dt>
              <dd>
The `authentication` property is OPTIONAL. If present, its
value MUST be a <a data-cite="INFRA#ordered-set">set</a> of one or more
<a>verification methods</a>. Each <a>verification method</a> MAY be embedded or
referenced.
              </dd>
            </dl>

            <pre class="example nohighlight" title="Authentication property
                          containing three verification methods">
    {
      "@context": [
        "https://www.w3.org/ns/did/v1",
        "https://www.w3.org/ns/credentials/v2",
        "https://w3id.org/security/multikey/v1"
      ],
      "id": "did:example:123456789abcdefghi",
      <span class="comment">...</span>
      "authentication": [
        <span class="comment">// this method can be used to authenticate as did:...fghi</span>
        "did:example:123456789abcdefghi#keys-1",
        <span class="comment">// this method is *only* approved for authentication, it may not</span>
        <span class="comment">// be used for any other proof purpose, so its full description is</span>
        <span class="comment">// embedded here rather than using only a reference</span>
        {
          "id": "did:example:123456789abcdefghi#keys-2",
          "type": "Multikey",
          "controller": "did:example:123456789abcdefghi",
          "publicKeyMultibase": "z6MkmM42vxfqZQsv4ehtTjFFxQ4sQKS2w6WR7emozFAn5cxu"
        }
      ],
      <span class="comment">...</span>
    }
            </pre>

            <p>
If authentication is established, it is up to the application to decide what to
do with that information.
            </p>
            <p>
This is useful to any <em>authentication verifier</em> that needs to check to
see if an entity that is attempting to <a>authenticate</a> is, in fact,
presenting a valid proof of authentication. When a <em>verifier</em> receives
some data (in some protocol-specific format) that contains a proof that was made
for the purpose of "authentication", and that says that an entity is identified
by the `id`, then that <em>verifier</em> checks to ensure that the proof can be
verified using a <a>verification method</a> (e.g., <a>public key</a>) listed
under `<a>authentication</a>` in the <a>controller document</a>.
            </p>
            <p>
Note that the <a>verification method</a> indicated by the
`<a>authentication</a>` property of a <a>controller document</a> can
only be used to <a>authenticate</a> the <a>controller</a>. To
<a>authenticate</a> a different <a>controller</a>, the entity associated with
the value of `controller` needs to <a>authenticate</a> with its
<em>own</em> <a>controller document</a> and associated
`<a>authentication</a>` <a>verification relationship</a>.
            </p>
          </section>

          <section>
            <h2>Assertion</h2>

            <p>
The `assertionMethod` <a>verification relationship</a> is used to
specify how the <a>controller</a> is expected to express claims, such as for
the purposes of issuing a
<a data-cite="?VC-DATA-MODEL-2.0#dfn-verifiable-credential">verifiable credential</a>.
            </p>

            <dl>
              <dt id="defn-assertionMethod">assertionMethod</dt>
              <dd>
The `assertionMethod` property is OPTIONAL. If present, its associated
value MUST be a <a data-cite="INFRA#ordered-set">set</a> of one or
more <a>verification methods</a>. Each <a>verification method</a> MAY
be embedded or referenced.
              </dd>
            </dl>

            <p>
This property is useful, for example, during the processing of a
<a data-cite="?VC-DATA-MODEL-2.0#dfn-verifiable-credential">verifiable credential</a>
by a verifier.
<!-- VC-DATA-INTEGRITY-SPECIFIC:
During verification, a verifier checks to see if a
<a>verifiable credential</a> contains a proof created by the <a>controller</a>
by checking that the <a>verification method</a> used to assert the proof is
associated with the `<a>assertionMethod</a>` property in the
corresponding <a>controller document</a>.
-->
            </p>

            <pre class="example nohighlight" title="Assertion method property
                        containing two verification methods">
    {
      "@context": [
        "https://www.w3.org/ns/did/v1",
        "https://www.w3.org/ns/credentials/v2",
        "https://w3id.org/security/multikey/v1"
      ],
      "id": "did:example:123456789abcdefghi",
      <span class="comment">...</span>
      "assertionMethod": [
        <span class="comment">// this method can be used to assert statements as did:...fghi</span>
        "did:example:123456789abcdefghi#keys-1",
        <span class="comment">// this method is *only* approved for assertion of statements, it is not</span>
        <span class="comment">// used for any other verification relationship, so its full description is</span>
        <span class="comment">// embedded here rather than using a reference</span>
        {
          "id": "did:example:123456789abcdefghi#keys-2",
          "type": "Multikey", <span class="comment">// external (property value)</span>
          "controller": "did:example:123456789abcdefghi",
          "publicKeyMultibase": "z6MkmM42vxfqZQsv4ehtTjFFxQ4sQKS2w6WR7emozFAn5cxu"
        }
      ],
      <span class="comment">...</span>
    }
            </pre>
          </section>

          <section>
            <h2>Key Agreement</h2>

            <p>
The `keyAgreement` <a>verification relationship</a> is used to
specify how an entity can generate encryption material in order to transmit
confidential information intended for the <a>controller</a>, such as for
the purposes of establishing a secure communication channel with the recipient.
            </p>

            <dl>
              <dt><dfn id="defn-keyAgreement">keyAgreement</dfn></dt>
              <dd>
The `keyAgreement` property is OPTIONAL. If present, the associated
value MUST be a <a data-cite="INFRA#ordered-set">set</a> of one or more
<a>verification methods</a>. Each <a>verification method</a> MAY be embedded or
referenced.
              </dd>
            </dl>

            <p>
An example of when this property is useful is when encrypting a message intended
for the <a>controller</a>. In this case, the counterparty uses the
cryptographic <a>public key</a> information in the <a>verification method</a> to
wrap a decryption key for the recipient.
            </p>

            <pre class="example nohighlight" title="Key agreement property
                          containing two verification methods">
    {
      "@context": "https://www.w3.org/ns/did/v1",
      "id": "did:example:123456789abcdefghi",
      <span class="comment">...</span>
      "keyAgreement": [
        <span class="comment">// this method can be used to perform key agreement as did:...fghi</span>
        "did:example:123456789abcdefghi#keys-1",
        <span class="comment">// this method is *only* approved for key agreement usage, it will not</span>
        <span class="comment">// be used for any other verification relationship, so its full description is</span>
        <span class="comment">// embedded here rather than using only a reference</span>
        {
          "id": "did:example:123#zC9ByQ8aJs8vrNXyDhPHHNNMSHPcaSgNpjjsBYpMMjsTdS",
          "type": "X25519KeyAgreementKey2019", <span class="comment">// external (property value)</span>
          "controller": "did:example:123",
          "publicKeyMultibase": "z6LSn6p3HRxx1ZZk1dT9VwcfTBCYgtNWdzdDMKPZjShLNWG7"
        }
      ],
      <span class="comment">...</span>
    }
            </pre>
          </section>

          <section>
            <h2>Capability Invocation</h2>

            <p>
The `capabilityInvocation` <a>verification relationship</a> is used
to specify a <a>verification method</a> that might be used by the
<a>controller</a> to invoke a cryptographic capability, such as the
authorization to update the <a>controller document</a>.
            </p>

            <dl>
              <dt id="defn-capabilityInvocation">capabilityInvocation</dt>
              <dd>
The `capabilityInvocation` property is OPTIONAL. If present, the
associated value MUST be a <a data-cite="INFRA#ordered-set">set</a> of
one or more <a>verification methods</a>. Each <a>verification method</a> MAY be
embedded or referenced.
              </dd>
            </dl>

            <p>
An example of when this property is useful is when a <a>controller</a> needs to
access a protected HTTP API that requires authorization in order to use it. In
order to authorize when using the HTTP API, the <a>controller</a>
uses a capability that is associated with a particular URL that is
exposed via the HTTP API. The invocation of the capability could be
expressed in a number of ways, e.g., as a digitally signed
message that is placed into the HTTP Headers.
            </p>
            <p>
The server providing the HTTP API is the <em>verifier</em> of the capability and
it would need to verify that the <a>verification method</a> referred to by the
invoked capability exists in the `capabilityInvocation`
property of the <a>controller document</a>. The verifier would also check to make sure
that the action being performed is valid and the capability is appropriate for
the resource being accessed. If the verification is successful, the server has
cryptographically determined that the invoker is authorized to access the
protected resource.
            </p>

            <pre class="example nohighlight" title="Capability invocation property
                          containing two verification methods">
    {
      "@context": [
        "https://www.w3.org/ns/did/v1",
        "https://w3id.org/security/multikey/v1"
      ],
      "id": "did:example:123456789abcdefghi",
      <span class="comment">...</span>
      "capabilityInvocation": [
        <span class="comment">// this method can be used to invoke capabilities as did:...fghi</span>
        "did:example:123456789abcdefghi#keys-1",
        <span class="comment">// this method is *only* approved for capability invocation usage, it will not</span>
        <span class="comment">// be used for any other verification relationship, so its full description is</span>
        <span class="comment">// embedded here rather than using only a reference</span>
        {
        "id": "did:example:123456789abcdefghi#keys-2",
        "type": "Multikey", <span class="comment">// external (property value)</span>
        "controller": "did:example:123456789abcdefghi",
        "publicKeyMultibase": "z6MkmM42vxfqZQsv4ehtTjFFxQ4sQKS2w6WR7emozFAn5cxu"
        }
      ],
      <span class="comment">...</span>
    }
            </pre>
          </section>

          <section>
            <h2>Capability Delegation</h2>

            <p>
The `capabilityDelegation` <a>verification relationship</a> is used
to specify a mechanism that might be used by the <a>controller</a> to delegate
a cryptographic capability to another party, such as delegating the authority
to access a specific HTTP API to a subordinate.
            </p>

            <dl>
              <dt id="defn-capabilityDelegation">capabilityDelegation</dt>
              <dd>
The `capabilityDelegation` property is OPTIONAL. If present, the
associated value MUST be a <a data-cite="INFRA#ordered-set">set</a> of
one or more <a>verification methods</a>. Each <a>verification method</a> MAY be
embedded or referenced.
              </dd>
            </dl>

            <p>
An example of when this property is useful is when a <a>controller</a> chooses
to delegate their capability to access a protected HTTP API to a party other
than themselves. In order to delegate the capability, the <a>controller</a>
would use a <a>verification method</a> associated with the
`capabilityDelegation` <a>verification relationship</a> to
cryptographically sign the capability over to another <a>controller</a>. The
delegate would then use the capability in a manner that is similar to the
example described in <a href="#capability-invocation"></a>.
            </p>

            <pre class="example nohighlight" title="Capability Delegation property
                          containing two verification methods">
    {
      "@context": [
        "https://www.w3.org/ns/did/v1",
        "https://w3id.org/security/multikey/v1"
      ],
      "id": "did:example:123456789abcdefghi",
      <span class="comment">...</span>
      "capabilityDelegation": [
        <span class="comment">// this method can be used to perform capability delegation as did:...fghi</span>
        "did:example:123456789abcdefghi#keys-1",
        <span class="comment">// this method is *only* approved for granting capabilities; it will not</span>
        <span class="comment">// be used for any other verification relationship, so its full description is</span>
        <span class="comment">// embedded here rather than using only a reference</span>
        {
        "id": "did:example:123456789abcdefghi#keys-2",
        "type": "Multikey", <span class="comment">// external (property value)</span>
        "controller": "did:example:123456789abcdefghi",
        "publicKeyMultibase": "z6MkmM42vxfqZQsv4ehtTjFFxQ4sQKS2w6WR7emozFAn5cxu"
        }
      ],
      <span class="comment">...</span>
    }
            </pre>
          </section>
        </section>
      </section>

      <section>
        <h2>Multibase</h2>

        <p class="issue"
           title="Multibase may be standardized at IETF">
The [[?MULTIBASE]] specification has been dispatched at IETF and may be
standardized there. There is active discussion on this initiative in
the <a href="https://mailarchive.ietf.org/arch/browse/multiformats/">
Multiformats mailing list at IETF</a>. If the Multibase draft is stabilized
before this specification goes to the Proposed Recommendation phase, the table
below will be replaced with normative references to the Multibase
specification at IETF. It is the intention of the Working Group to ensure
alignment between the Multibase values used in this specification and the
Multibase values defined by the current Multibase community and any potential
future IETF Multiformats Working Group.
        </p>

        <p>
A Multibase string includes a single character header which identifies the
base and encoding alphabet used to encode a binary value, followed by the
encoded binary value (using that base and alphabet). The common Multibase
header values and their associated base encoding alphabets as provided below
are normative:
        </p>

        <table class="simple">
          <thead>
            <tr>
              <th>Multibase&nbsp;Header</th>
              <th>Description</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>`u`</td>
              <td>
The base-64-url-no-pad alphabet is used to encode the bytes. The base-alphabet
consists of the following characters, in order:
`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_`
              </td>
            </tr>
            <tr>
              <td>`z`</td>
              <td>
The base-58-btc alphabet is used to encode the bytes. The base-alphabet consists
of the following characters, in order:
`123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz`
              </td>
            </tr>
          </tbody>
        </table>

        <p>
Other Multibase encoding values MAY be used, but interoperability is not
guaranteed between implementations using such values.
        </p>

        <p>
To base-encode a binary value into a Multibase string, an implementation MUST
apply the algorithm in Section <a href="#base-encode"></a> to the binary value,
with the desired base encoding and alphabet from the table above, ensuring to
prepend the associated Multibase header from the table above to the result.
Any algorithm with equivalent output MAY be used.
        </p>

        <p>
To base-decode a Multibase string, an implementation MUST apply the algorithm
in Section <a href="#base-decode"></a> to the string following the first
character (Multibase header), with the alphabet associated with the
Multibase header. Any algorithm with equivalent output MAY be used.
        </p>

      </section>

      <section>
        <h2>Multihash</h2>

        <p class="issue" title="Multihash may be standardized at IETF">
The [[?MULTIHASH]] specification has been dispatched at IETF and may be
standardized. There is active discussion on this initiative in
the <a href="https://mailarchive.ietf.org/arch/browse/multiformats/">
Multiformats mailing list at IETF</a>. If the IETF draft is stabilized
before this specification goes to the Proposed Recommendation phase, the table
below will be replaced with normative references to the Multihash
specification. It is the intention of the Working Group to ensure
alignment between the Multihash values used in this specification and the
Multihash values defined by the current Multihash community and any potential
future IETF Multiformats Working Group.
        </p>

        <p>
A Multihash value starts with a binary header, which identifies the specific
cryptographic hash algorithm and parameters used to generate the digest,
followed by the cryptographic digest value. The normative Multihash header
values defined by this specification, and their associated output sizes and
associated specifications, are provided below:
        </p>

        <table class="simple">
          <thead>
            <tr>
              <th>Multihash&nbsp;Identifier</th>
              <th>Multihash&nbsp;Header</th>
              <th>Description</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>`sha2-256`</td>
              <td>`0x12`</td>
              <td>
SHA-2 with 256 bits (32 bytes) of output, as defined by [[RFC6234]].
              </td>
            </tr>
            <tr>
              <td>`sha2-384`</td>
              <td>`0x20`</td>
              <td>
SHA-2 with 384 bits (48 bytes) of output, as defined by [[RFC6234]].
              </td>
            </tr>
            <tr>
              <td>`sha3-256`</td>
              <td>`0x16`</td>
              <td>
SHA-3 with 256 bits (32 bytes) of output, as defined by [[SHA3]].
              </td>
            </tr>
            <tr>
              <td>`sha3-384`</td>
              <td>`0x15`</td>
              <td>
SHA-3 with 384 bits (48 bytes) of output, as defined by [[SHA3]].
              </td>
            </tr>
          </tbody>
        </table>

        <p>
Other Multihash encoding values MAY be used, but interoperability is not
guaranteed between implementations.
        </p>

        <p>
To encode to a Multihash value, an implementation MUST prepend the associated
Multihash header value to the cryptographic hash value.
        </p>

        <p>
To decode a Multihash value, an implementation MUST remove the prepended
Multihash header value, which identifies the type of cryptographic hashing
algorithm as well as its output length, leaving the raw cryptographic hash
value which MUST match the output length associated with the Multihash header.
        </p>

      </section>


      <section>
        <h2>Contexts and Vocabularies</h2>

        <p class="issue" title="(AT RISK) Hash values might change during Candidate Recommendation">
This section lists cryptographic hash values that might change during the
Candidate Recommendation phase based on implementer feedback that requires
the referenced files to be modified.
        </p>
        <p>
Implementations that perform JSON-LD processing MUST treat the following
JSON-LD context URLs as already resolved, where the resolved document matches
the corresponding hash values below:
        </p>

        <table class="simple">
          <thead>
            <tr>
              <th>URL and Media Type</th>
              <th>Content</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="white-space: nowrap;">
https://w3id.org/security/data-integrity/v2<br>
application/ld+json
              </td>
              <td>
sha256: v/POI0jhSjPansxhJAP1fwepCBZ2HK77fRZfCCyBDs0=<br><br>
sha3-512: Sg1PLFxKyEYQns9Zr0BoYXtFeDNfrHUDNMkyq4QEWv<wbr>wGIaX1v5xovnCG+dfceZEzr7BhBjm396noZF1HEeCM8g==
              </td>
            </tr>
            <tr>
              <td style="white-space: nowrap;">
https://w3id.org/security/multikey/v1<br>
application/ld+json
              </td>
              <td>
sha256: uiwYLeLZL35HGEvMqPzwvq7m05hsUnv2ZMGVu8fFhZc=<br><br>
sha3-512: En0TOOp/cC10XtW/aQDtqKrEQZ2lRjGB/KAsJ+BQhRB<wbr>ufT7s6eoOFWvP9cP5nurTl3hcRTvFeffdVJapkeELXw==
              </td>
            </tr>
            <tr>
              <td style="white-space: nowrap;">
https://w3id.org/security/jwk/v1<br>
application/ld+json
              </td>
              <td>
sha256: 9h/GLRVuGCl0rn/ye6lzf219aN7Sgzq9yBFqUoOI54k=<br><br>
sha3-512: VDH85TsaX6kH2nwmII0WXKzAi2MRNsJd+rJfYL5cw0b<wbr>12sAVPKDsVvRNJo0MMGd1RhV5W6Ii6D9GM7PCFeq97A==
              </td>
            </tr>
          </tbody>
        </table>

        <p>
The security vocabulary terms that the JSON-LD contexts listed above resolve
to are in the <a href="https://w3id.org/security">https://w3id.org/security#</a>
namespace. That is, all security terms in this vocabulary are of the form
`https://w3id.org/security#TERM`, where `TERM` is the name of a term.
        </p>

        <p>
Implementations that perform RDF processing MUST treat the following
JSON-LD vocabulary URL as already resolved, where the resolved document matches
the corresponding hash values below.
        </p>

        <p>
When dereferencing the
<a href="https://w3id.org/security">https://w3id.org/security#</a> URL,
the data returned depends on HTTP content negotiation. These are as follows:
        </p>

        <table class="simple">
          <thead>
            <tr>
              <th>Media Type</th>
              <th>Description and Cryptographic Hashes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
application/ld+json
              </td>
              <td>
The vocabulary in JSON-LD format [[?JSON-LD11]].<br><br>

sha256: LEaoTyf796eTaSlYWjfPe3Yb+poCW9TjWYTbFDmC0tc=<br><br>

sha3-512: f4DhJ3xhT8nT+GZ8UUZi4QC+HT//wXE2fRTgUP4UNw<wbr>e4kvel2PFfd6jcofHBm9BjwEiGzVFGv4K+fFTKXRD2NA==
              </td>
            </tr>
            <tr>
              <td>
text/turtle
              </td>
              <td>
The vocabulary in Turtle format [[?TURTLE]].<br><br>
sha256: McnhLyt7+/A/0iLb3CUXD0itNw+7bwwjtzOww/zwoyI=<br><br>
sha3-512: jZtZsqgPPPo+jphAcN8/St4VdRLLAmN3nEQhzs0twE<wbr>MTmCY45euQ01Z4Zo7VlJMYNTf0KC6BMpogpSTAi/1J7Q==
              </td>
            </tr>
            <tr>
              <td>
text/html
              </td>
              <td>
The vocabulary in HTML+RDFa Format [[?HTML-RDFA]].<br><br>
sha256: eUHP1xiSC157iTPDydZmxg/hvmX3g/nnCn+FO25d4dc=<br><br>
sha3-512: z53j8ryjVeX16Z/dby//ujhw37degwi09+LAZCTUB8<wbr>WJZjjzW1AydhdEWmgHM0P5KUcPMmSe7edMlGr7G9rmcA==
              </td>
            </tr>
          </tbody>
        </table>

        <p>
It is possible to confirm the digests listed above by running the following
command from a modern Unix command interface line:
`curl -sL -H "Accept: &lt;MEDIA_TYPE>" &lt;DOCUMENT_URL> | openssl dgst -&ltDIGEST_ALGORITHM> -binary | openssl base64 -nopad -a`.
        </p>

        <p>
Authors of application-specific vocabularies and specifications SHOULD ensure
that their JSON-LD context and vocabulary files are permanently cacheable
using the approaches to caching described above or a functionally equivalent
mechanism.
        </p>

        <p>
Implementations MAY load application-specific JSON-LD context files from the
network during development, but SHOULD permanently cache JSON-LD context files
used in <a>conforming documents</a> in production settings to increase their
security and privacy characteristics. Caching goals MAY be achieved through
approaches such as those described above or functionally equivalent mechanisms.
        </p>
        <p>
Some applications, such as digital wallets, that are capable of holding arbitrary
<a data-cite="?VC-DATA-MODEL-2.0#dfn-verifiable-credential">verifiable credentials</a>
or other data-integrity-protected documents, from
any issuer and using any contexts, might need to be able to load externally
linked resources, such as JSON-LD context files, in production settings. This is
expected to increase user choice, scalability, and decentralized upgrades in the
ecosystem over time. Authors of such applications are advised to read the
security and privacy sections of this document for further considerations.
        </p>

        <p>
For further information regarding processing of JSON-LD contexts and
vocabularies, see <a data-cite="?VC-DATA-MODEL-2.0#base-context">Verifiable
Credentials v2.0: Base Context</a> and <a data-cite="?VC-DATA-MODEL-2.0#vocabularies">
Verifiable Credentials v2.0: Vocabularies</a>.
        </p>

        <section>
          <h3>Context Injection</h3>

          <p>
The `@context` property is used to ensure that implementations are using the
same semantics when terms in this specification are processed. For example, this
can be important when properties like `type` are processed and its value, such
as `DataIntegrityProof`, are used.
          </p>

          <p>
If an `@context` property is not provided in a document that is being secured or
verified, or the Data Integrity terms used in the document are not mapped by
existing values in the `@context` property, implementations MUST inject or add
an `@context` property with a value of
`https://w3id.org/security/data-integrity/v2`.
          </p>

          <p>
Context injection is expected to be unnecessary sometimes, such as when the Verifiable
Credential Data Model v2.0 context (`https://www.w3.org/ns/credentials/v2`)
exists as a value in the `@context` property, as that context maps all of the
necessary Data Integrity terms that were previously mapped by
`https://w3id.org/security/data-integrity/v2`.
          </p>
        </section>

        <section>
          <h3>Datatypes</h3>

          <p>
This section defines datatypes that are used by this specification.
          </p>

        <section>
          <h4 id="multibase">The `multibase` Datatype</h3>

          <p>
<a href="#multibase">Multibase</a>-encoded strings are used to encode binary
data into ASCII-only formats, which are useful in environments that cannot
directly represent binary values. This specification makes use of this encoding.
In environments that support data types for string values, such as RDF
[[?RDF-CONCEPTS]], <a href="#multibase">Multibase</a>-encoded content is
indicated using a literal value whose datatype is set to
`https://w3id.org/security#multibase`.
          </p>

          <p>
The `multibase` datatype is defined as follows:
          </p>

          <dl>
            <dt>The URL denoting this datatype</dt>
            <dd>
`https://w3id.org/security#multibase`
            </dd>
            <dt>The lexical space</dt>
            <dd>
Any string that starts with a <a href="#multibase">Multibase</a> character and
the rest of the characters consist of allowable characters in the respective
base-encoding alphabet.
            </dd>
            <dt>The value space</dt>
            <dd>
The standard mathematical concept of all integer numbers.
            </dd>
            <dt>The lexical-to-value mapping</dt>
            <dd>
Any element of the lexical space is mapped to the value space by base-decoding
the value based on the base-decoding alphabet associated with the
first <a href="#multibase">Multibase</a> character in the lexical string.
            </dd>
            <dt>The canonical mapping</dt>
            <dd>
The canonical mapping consists of using the lexical-to-value mapping.
            </dd>
          </dl>
        </section>

      </section>

    </section>

    </section>

    <section>
      <h2>Algorithms</h2>

      <p>
This section defines algorithms used by this specification including
instructions on how to base-encode and base-decode values, safely retrieve
verification methods, and produce processing errors over HTTP channels.
      </p>

      <section class="normative">
        <h2>Base Encode</h2>

        <p>
The following algorithm specifies how to encode an array of bytes, where each
byte represents a base-256 value, to a different base representation that uses a
particular base alphabet, such as base-64-url-no-pad or base-58-btc. The
required inputs are the <var>bytes</var>, <var>targetBase</var>, and
<var>baseAlphabet</var>. The output is a string that contains the base-encoded
value. All mathematical operations MUST be performed using integer arithmetic.
Alternatives to the algorithm provided below MAY be used as long as the
outputs of the alternative algorithm remain the same.
        </p>

        <ol class="algorithm">
          <li>
Initialize the following variables; <var>zeroes</var> to `0`, <var>length</var> to
`0`, <var>begin</var> to `0`, and <var>end</var> to the length of
<var>bytes</var>.
          </li>
          <li>
Set <var>begin</var> and <var>zeroes</var> to the number of leading `0` byte
values in <var>bytes</var>.
          </li>
          <li>
Set <var>baseValue</var> to an empty byte array that is the size of the final
base-expanded value. Calculate the final <var>size</var> of <var>baseValue</var>
by dividing log(256) by log(<var>targetBase</var>) and then multiplying the
length of <var>bytes</var> minus the leading <var>zeroes</var>. Add `1` to the
value of <var>size</var>.
          </li>
          <li>
Process each byte in <var>bytes</var> as <var>byte</var> starting at offset
<var>begin</var>:
            <ol class="algorithm">
              <li>
Set the <var>carry</var> value to <var>byte</var>.
              </li>
              <li>
Perform base-expansion by starting at the end of the <var>baseValue</var> array.
Initialize an iterator <var>i</var> to `0`. Set <var>basePosition</var> to
<var>size</var> minus `1`. Perform the following loop as long as <var>carry</var>
does not equal `0` or <var>i</var> is less than <var>length</var>, and
<var>basePosition</var> does not equal `-1`.
                <ol class="algorithm">
                  <li>
Multiply the value in <var>baseValue[basePosition]</var> by `256` and add
it to <var>carry</var>.
                  </li>
                  <li>
Set the value at <var>baseValue[basePosition]</var> to the remainder after
dividing <var>carry</var> by <var>targetBase</var>.
                  </li>
                  <li>
Set the value of <var>carry</var> to <var>carry</var> divided by
<var>targetBase</var> ensuring that integer division is used to perform the
division.
                  </li>
                  <li>
Decrement <var>basePosition</var> by `1` and increment <var>i</var> by `1`.
                  </li>
                </ol>
              </li>
              <li>
Set <var>length</var> to <var>i</var> and increment <var>begin</var> by `1`.
              </li>
            </ol>
          </li>
          <li>
Set the <var>baseEncodingPosition</var> to <var>size</var> minus <var>length</var>.
While the <var>baseEncodingPosition</var> does not equal <var>size</var> and the
<var>baseValue[baseEncodingPosition]</var> does not equal `0`, increment
<var>baseEncodingPosition</var>. This step skips the leading zeros in the
base-encoded result.
          </li>
          <li>
Initialize the <var>baseEncoding</var> by repeating the first entry in the
<var>baseAlphabet</var> by the value of <var>zeroes</var> (the number of leading
zeroes in <var>bytes</var>).
          </li>
          <li>
Convert the rest of the <var>baseValue</var> to the base-encoding. While the
<var>baseEncodingPosition</var> is less than <var>size</var>, increment the
<var>baseEncodingPosition</var>: Set <var>baseEncodedValue</var> to
<var>baseValue</var>[<var>baseEncodingPosition</var>]. Append
<var>baseAlphabet</var>[<var>baseEncodedValue</var>] to <var>baseEncoding</var>.
          </li>
          <li>
Return <var>baseEncoding</var> as the base-encoded value.
          </li>
        </ol>

        <pre class="example" title="An implementation of the general base-encoding algorithm above in Javascript">
function baseEncode(bytes, targetBase, baseAlphabet) {
  let zeroes = 0;
  let length = 0;
  let begin = 0;
  let end = bytes.length;

  // count the number of leading bytes that are zero
  while(begin !== end && bytes[begin] === 0) {
    begin++;
    zeroes++;
  }

  // allocate enough space to store the target base value
  const baseExpansionFactor = Math.log(256) / Math.log(targetBase);
  let size = Math.floor((end - begin) * baseExpansionFactor + 1);
  let baseValue = new Uint8Array(size);

  // process the entire input byte array
  while(begin !== end) {
    let carry = bytes[begin];

    // for each byte in the array, perform base-expansion
    let i = 0;
    for(let basePosition = size - 1;
        (carry !== 0 || i < length) && (basePosition !== -1);
        basePosition--, i++) {
      carry += Math.floor(256 * baseValue[basePosition]);
      baseValue[basePosition] = Math.floor(carry % targetBase);
      carry = Math.floor(carry / targetBase);
    }

    length = i;
    begin++;
  }

  // skip leading zeroes in base-encoded result
  let baseEncodingPosition = size - length;
  while(baseEncodingPosition !== size &&
        baseValue[baseEncodingPosition] === 0) {
    baseEncodingPosition++;
  }

  // convert the base value to the base encoding
  let baseEncoding = baseAlphabet.charAt(0).repeat(zeroes)
  for(; baseEncodingPosition < size; ++baseEncodingPosition) {
    baseEncoding += baseAlphabet.charAt(baseValue[baseEncodingPosition])
  }

  return baseEncoding;
}
        </pre>
      </section>

      <section class="normative">
        <h2>Base Decode</h2>

        <p>
The following algorithm specifies how to decode an array of bytes, where each
byte represents a base-encoded value, to a different base representation that
uses a particular base alphabet, such as base-64-url-no-pad or base-58-btc. The
required inputs are the <var>sourceEncoding</var>, <var>sourceBase</var>, and
<var>baseAlphabet</var>. The output is an array of bytes that contains the
base-decoded value. All mathematical operations MUST be performed using integer
arithmetic. Alternatives to the algorithm provided below MAY be used as long as
the outputs of the alternative algorithm remain the same.
        </p>

        <ol class="algorithm">
          <li>
Initialize a <var>baseMap</var> mapping by associating each character
in <var>baseAlphabet</var> to its integer position in the
<var>baseAlphabet</var> string.
          </li>
          <li>
Initialize the following variables; <var>sourceOffset</var> to `0`,
<var>zeroes</var> to `0`, and <var>decodedLength</var> to `0`.
          </li>
          <li>
Set <var>zeroes</var> and <var>sourceOffset</var> to the number of leading
<var>baseAlphabet[0]</var> values in <var>sourceEncoding</var>.
          </li>
          <li>
Set <var>decodedBytes</var> to an empty byte array that is the size of the final
base-converted value. Calculate the size of <var>decodedBytes</var>
by dividing log(<var>sourceBase</var>) by log(`256`) and then multiplying by the
length of <var>sourceEncoding</var> minus the leading zeroes. Add 1 to the value
of size.
          </li>
          <li>
Process each character in <var>sourceEncoding</var> as <var>character</var>
starting at offset <var>sourceOffset</var>:
            <ol class="algorithm">
              <li>
Set the <var>carry</var> value to the integer value in the <var>baseMap</var>
that is associated with <var>character</var>.
              </li>
              <li>
Perform base-decoding by starting at the end of the <var>decodedBytes</var>
array. Initialize an iterator <var>i</var> to `0`. Set <var>byteOffset</var>
to <var>decodedSize</var> minus `1`. Perform the following loop as long as,
<var>carry</var> does not equal `0` or <var>i</var> is less than
<var>decodedLength</var>, and <var>byteOffset</var> does not equal `-1`:
                <ol class="algorithm">
                  <li>
Add the result of multiplying <var>sourceBase</var> by
<var>decodedBytes</var>[<var>byteOffset</var>] to <var>carry</var>.
                  </li>
                  <li>
Set <var>decodedBytes</var>[<var>byteOffset</var>] to the remainder of
dividing <var>carry</var> by `256`.
                  </li>
                  <li>
Set <var>carry</var> to <var>carry</var> divided by `256`, ensuring that integer
division is used to perform the division.
                  </li>
                  <li>
Decrement <var>byteOffset</var> by `1` and increment <var>i</var> by `1`.
                  </li>
                </ol>
                <li>
Set <var>decodedLength</var> to <var>i</var> and increment
<var>sourceOffset</var> by `1`.
                </li>
              </li>
            </ol>
          </li>
          <li>
Set the <var>decodedOffset</var> to <var>decodedSize</var> minus
<var>decodedLength</var>. While the <var>decodedOffset</var> does not equal
the <var>decodedSize</var> and
<var>decodedBytes</var>[<var>decodedOffset</var>] equals `0`, increment
<var>decodedOffset</var> by `1`. This step skips the leading zeros in the
final base-decoded byte array.
          </li>
          <li>
Set the size of the <var>finalBytes</var> array to <var>zeroes</var> plus,
<var>decodedSize</var> minus <var>decodedOffset</var>. Initialize the first
<var>zeroes</var> bytes in <var>finalBytes</var> to `0`.
          </li>
          <li>
Starting at an offset equal to the number of <var>zeroes</var> in
<var>finalBytes</var> plus `1`, copy all bytes in <var>decodedBytes</var>, up
to <var>decodedSize</var>, starting at offset <var>decodedOffset</var> to
<var>finalBytes</var>.
          </li>
        </ol>

        <pre class="example" title="An implementation of the general base-decoding algorithm above in Javascript">
function baseDecode(sourceEncoding, sourceBase, baseAlphabet) {
  // build the base-alphabet to integer value map
  baseMap = {};
  for(let i = 0; i < baseAlphabet.length; i++) {
    baseMap[baseAlphabet[i]] = i;
  }

  // skip and count zero-byte values in the sourceEncoding
  let sourceOffset = 0;
  let zeroes = 0;
  let decodedLength = 0;
  while(sourceEncoding[sourceOffset] === baseAlphabet[0]) {
    zeroes++;
    sourceOffset++;
  }

  // allocate the decoded byte array
  const baseContractionFactor = Math.log(sourceBase) / Math.log(256);
  let decodedSize = Math.floor((
    (sourceEncoding.length - sourceOffset) * baseContractionFactor) + 1);
  let decodedBytes = new Uint8Array(decodedSize);

  // perform base-conversion on the source encoding
  while(sourceEncoding[sourceOffset]) {
    // process each base-encoded number
    let carry = baseMap[sourceEncoding[sourceOffset]];

    // convert the base-encoded number by performing base-expansion
    let i = 0
    for(let byteOffset = decodedSize - 1;
      (carry !== 0 || i < decodedLength) && (byteOffset !== -1);
      byteOffset--, i++) {
      carry += Math.floor(sourceBase * decodedBytes[byteOffset]);
      decodedBytes[byteOffset] = Math.floor(carry % 256);
      carry = Math.floor(carry / 256);
    }

    decodedLength = i;
    sourceOffset++;
  }

  // skip leading zeros in the decoded byte array
  let decodedOffset = decodedSize - decodedLength;
  while(decodedOffset !== decodedSize && decodedBytes[decodedOffset] === 0) {
    decodedOffset++;
  }

  // create the final byte array that has been base-decoded
  let finalBytes = new Uint8Array(zeroes + (decodedSize - decodedOffset));
  let j = zeroes;
  while(decodedOffset !== decodedSize) {
    finalBytes[j++] = decodedBytes[decodedOffset++];
  }

  return finalBytes;
}
        </pre>

      </section>

      <section class="normative">
        <h3>Retrieve Verification Method</h3>

        <p>
The following algorithm specifies how to safely retrieve a verification method,
such as a cryptographic <a>public key</a>, by using a <a>verification method</a>
identifier. Required inputs are a
<strong><a>verification method</a></strong> (<var>verificationMethod</var>),
a <strong>proof purpose</strong> (<var>proofPurpose</var>), and
a set of <strong>dereferencing options</strong> (<var>options</var>). A
<strong>verification method</strong> is produced as output.
        </p>

        <ol class="algorithm">
          <li>
Let <var>vmIdentifier</var> be set to <var>verificationMethod</var>.
          </li>
          <li>
Let <var>vmPurpose</var> be set to <var>proofPurpose</var>.
          </li>
          <li>
If <var>vmIdentifier</var> is not a valid URL, an error MUST be raised and SHOULD
convey an error type of
<a href="#INVALID_VERIFICATION_METHOD_URL">INVALID_VERIFICATION_METHOD_URL</a>.
          </li>
          <li>
Let <var>controllerDocumentUrl</var> be the result of parsing
<var>vmIdentifier</var> according to the rules of the URL scheme and extracting
the primary resource identifier (without the fragment identifier).
          </li>
          <li>
Let <var>vmFragment</var> be the result of parsing <var>vmIdentifier</var>
according to the rules of the URL scheme and extracting the secondary
resource identifier (the fragment identifier).
          </li>
          <li>
Let <var>controllerDocument</var> be the result of dereferencing
<var>controllerDocumentUrl</var>, according to the rules
of the URL scheme and using the supplied <var>options</var>.
          </li>
          <li>
If <var>controllerDocument</var>.<var>id</var> does not match the
<var>controllerDocumentUrl</var>, an error MUST be raised and SHOULD
convey an error type of
<a href="#INVALID_CONTROLLER_DOCUMENT_ID">INVALID_CONTROLLER_DOCUMENT_ID</a>.
          </li>
          <li>
If <var>controllerDocument</var> is not a valid <a>controller document</a>,
an error MUST be raised and SHOULD
convey an error type of
<a href="#INVALID_CONTROLLER_DOCUMENT">INVALID_CONTROLLER_DOCUMENT</a>.
          </li>
          <li>
Let <var>verificationMethod</var> be the result of dereferencing the
<var>vmFragment</var> from the <var>controllerDocument</var> according to the
rules of the media type of the <var>controllerDocument</var>.
          </li>
          <li>
If <var>verificationMethod</var> is not a valid <a>verification method</a>,
an error MUST be raised and SHOULD convey an error type of
<a href="#INVALID_VERIFICATION_METHOD">INVALID_VERIFICATION_METHOD</a>.
          </li>
          <li>
If <var>verificationMethod</var> is not associated with the array of
<var>vmPurposes</var> in the <var>controllerDocument</var>, either by reference
(URL) or by value (object), an error MUST be raised and SHOULD convey an error
type of <a href="#INVALID_PROOF_PURPOSE_FOR_VERIFICATION_METHOD">
INVALID_PROOF_PURPOSE_FOR_VERIFICATION_METHOD</a>.
          </li>
          <li>
Return <var>verificationMethod</var> as the
<strong>verification method</strong>.
          </li>
        </ol>

        <p>
The following example provides a minimum conformant
<a>controller document</a> containing a minimum conformant
<a>verification method</a> as required by the algorithm in this section:
        </p>

        <pre class="example" title="Minimum conformant controller document">
{
  "id": "https://controller.example/123",
  "verificationMethod": [{
    "id": "https://controller.example/123#key-456",
    "type": "ExampleVerificationMethodType",
    "controller": "https://controller.example/123",
    <span class="comment">// public cryptographic material goes here</span>
  }],
  "authentication": ["#key-456"]
}
        </pre>

      </section>

      <section class="normative">
        <h3>Processing Errors</h3>

        <p>
The algorithms described in this specification throw specific types of errors.
Implementers might find it useful to convey these errors to other libraries or
software systems. This section provides specific URLs, descriptions, and error
codes for the errors, such that an ecosystem implementing technologies described
by this specification might interoperate more effectively when errors occur.
        </p>

        <p>
When exposing these errors through an HTTP interface, implementers SHOULD use
[[RFC9457]] to encode the error data structure. If [[RFC9457]] is used:
        </p>

        <ul>
          <li>
The `type` value of the error object MUST be a URL that starts with the value
`https://w3id.org/security#` and ends with the value in the section listed
below.
          </li>
          <li>
The `code` value MUST be the integer code described in the table below
(in parentheses, beside the type name).
          </li>
          <li>
The `title` value SHOULD provide a short but specific human-readable string for
the error.
          </li>
          <li>
The `detail` value SHOULD provide a longer human-readable string for the error.
          </li>
        </ul>

        <dl>
          <dt id="INVALID_VERIFICATION_METHOD_URL">INVALID_VERIFICATION_METHOD_URL (-21)</dt>
          <dd>
The `verificationMethod` value in a proof was malformed. See Section
<a href="#retrieve-verification-method"></a>.
          </dd>
          <dt id="INVALID_CONTROLLER_DOCUMENT_ID">INVALID_CONTROLLER_DOCUMENT_ID (-22)</dt>
          <dd>
The `id` value in a <a>controller document</a> was malformed. See Section
<a href="#retrieve-verification-method"></a>.
          </dd>
          <dt id="INVALID_CONTROLLER_DOCUMENT">INVALID_CONTROLLER_DOCUMENT (-23)</dt>
          <dd>
The <a>controller document</a> was malformed. See Section
<a href="#retrieve-verification-method"></a>.
          </dd>
          <dt id="INVALID_VERIFICATION_METHOD">INVALID_VERIFICATION_METHOD (-24)</dt>
          <dd>
The <a>verification method</a> in a <a>controller document</a> was malformed. See Section
<a href="#retrieve-verification-method"></a>.
          </dd>
          <dt id="INVALID_PROOF_PURPOSE_FOR_VERIFICATION_METHOD">INVALID_PROOF_PURPOSE_FOR_VERIFICATION_METHOD (-25)</dt>
          <dd>
The [=verification method=] in a [=controller document=] was not
associated using the expected [=verification relationship=] as expressed in
the `proofPurpose` property in the proof. See Section
[[[#retrieve-verification-method]]].
          </dd>
        </dl>
      </section>
    </section>

  <section class="informative">
    <h1>Security Considerations</h1>

    <p>
This section contains a variety of security considerations that people using
this specification are advised to consider before deploying this
technology in a production setting. This technologies described in this
document are designed to operate under the threat model used by many IETF
standards and documented in [[?RFC3552]]. This section elaborates upon a number
of the considerations in [[?RFC3552]], as well as other considerations that are
unique to this specification.
    </p>

    <section>
      <h2>Proving Control and Binding</h2>

      <p>
Binding an entity in the digital world or the physical world to an identifier, to
a <a>controller document</a>, or to cryptographic material requires, the use of
security protocols contemplated by this specification. The following sections
describe some possible scenarios and how an entity therein might prove control
over an identifier or a <a>controller document</a> for the purposes of authentication or
authorization.
      </p>

      <section class="notoc">
        <h3>Proving Control of a DID and/or Controller Document</h3>

        <p>
Proving control over an identifier and/or a <a>controller document</a> is useful
when accessing remote systems. Cryptographic digital signatures enable certain
security protocols related to <a>controller documents</a>
to be cryptographically verifiable. For these purposes, this specification
defines useful <a>verification relationships</a> in <a
href="#authentication"></a> and <a href="#capability-invocation"></a>. The
secret cryptographic material associated with the <a>verification methods</a>
can be used to generate a cryptographic digital signature as a part of an
authentication or authorization security protocol.
        </p>
      </section>

      <section class="notoc">
        <h3>Binding to Physical Identity</h3>

        <p>
An identifier or <a>controller document</a> do not inherently carry any
<a href="https://en.wikipedia.org/wiki/Personal_data">personal data</a> and
it is strongly advised that non-public entities do not publish personal data in
<a>controller documents</a>.
        </p>

        <p>
It can be useful to express a binding of an identifier to a person's or
organization's physical identity in a way that is provably asserted by a
trusted authority, such as a government. This specification provides
the <a href="#assertion"></a> <a>verification relationship</a> for these
purposes. This feature can enable interactions that are private and can be
considered legally enforceable under one or more jurisdictions; establishing
such bindings has to be carefully balanced against privacy considerations (see
<a href="#privacy-considerations"></a>).
        </p>

        <p>
The process of binding an identifier to something in the physical world, such as
a person or an organization &mdash; for example, by using <a>verifiable
credentials</a> with the same subject as that identifier &mdash; is contemplated
by this specification and further defined in [[[?VC-DATA-MODEL-2.0]]].
        </p>
      </section>
    </section>

    <section>
      <h2>Key and Signature Expiration</h2>

      <p>
In a decentralized architecture, there might not be centralized authorities to
enforce cryptographic material or cryptographic digital signature expiration
policies. Therefore, it is with supporting software such as verification
libraries that requesting parties validate that cryptographic material were not
expired at the time they were used. Requesting parties might employ their own
expiration policies in addition to inputs into their verification processes. For
example, some requesting parties might accept authentications from five minutes
in the past, while others with access to high precision time sources might
require authentications to be time stamped within the last 500 milliseconds.
      </p>
      <p>
There are some requesting parties that have legitimate needs to extend the use
of already-expired cryptographic material, such as verifying legacy
cryptographic digital signatures. In these scenarios, a requesting party might
instruct their verification software to ignore cryptographic key material
expiration or determine if the cryptographic key material was expired at the
time it was used.
      </p>
    </section>

    <section>
      <h2>Verification Method Rotation</h2>

      <p>
Rotation is a management process that enables the secret cryptographic material
associated with an existing <a>verification method</a> to be deactivated or
destroyed once a new <a>verification method</a> has been added to the
<a>controller document</a>. Going forward, any new proofs that a
<a>controller</a> would have generated using the old secret cryptographic
material can now instead be generated using the new  cryptographic material and
can be verified using the new <a>verification method</a>.
      </p>

      <p>
Rotation is a useful mechanism for protecting against verification method
compromise, since frequent rotation of a verification method by the controller
reduces the value of a single compromised verification method to an attacker.
Performing revocation immediately after rotation is useful for verification
methods that a controller designates for short-lived verifications, such as
those involved in encrypting messages and authentication.
      </p>

      <p>
The following considerations might be of use when contemplating the use of
<a>verification method</a> rotation:
      </p>

      <ul>
        <li>
<a>Verification method</a> rotation is a proactive security measure.
        </li>
        <li>
It is generally considered a best practice to perform <a>verification method</a>
rotation on a regular basis.
        </li>
        <li>
Higher security environments tend to employ more frequent verification method
rotation.
        </li>
        <li>
<a>Verification method</a> rotation manifests only as changes to the current or
latest version of a <a>controller document</a>.
        </li>
        <li>
When a <a>verification method</a> has been active for a long time, or used for
many operations, a controller might wish to perform a rotation.
        </li>
        <li>
Frequent rotation of a <a>verification method</a> might be frustrating for
parties that are forced to continuously renew or refresh associated credentials.
        </li>
        <li>
Proofs or signatures that rely on <a>verification methods</a> that are not
present in the latest version of a <a>controller document</a> are not impacted by
rotation. In these cases, verification software might require additional
information, such as when a particular <a>verification method</a> was
expected to be valid as well as access to a <a>verifiable data registry</a>
containing a historical record, to determine the validity of the proof or
signature. This option might not be available in all systems.
        </li>
        <li>
A <a>controller</a> performs a rotation when they add a new <a>verification
method</a> that is meant to replace an existing <a>verification method</a> after
some time.
        </li>
      </ul>
    </section>

    <section>
      <h2>Verification Method Revocation</h2>

      <p>
Revocation is a management process that enables the secret cryptographic
material associated with an existing <a>verification method</a> to be
deactivated such that it ceases to be a valid form of creating new
proofs.
      </p>
      <p>
Revocation is a useful mechanism for reacting to a verification method
compromise. Performing revocation immediately after rotation is useful for
verification methods that a controller designates for short-lived verifications,
such as those involved in encrypting messages and authentication.
      </p>

      <p>
Compromise of the secrets associated with a <a>verification method</a> allows
the attacker to use them according to the <a>verification relationship</a>
expressed by <a>controller</a> in the <a>controller document</a>, for example, for
authentication. The attacker's use of the secrets might be indistinguishable
from the legitimate [=controller=]'s use starting from
the time the <a>verification method</a> was registered, to the time it was
revoked.
      </p>


      <p>
The following considerations might be of use when contemplating the use of
<a>verification method</a> revocation:
      </p>

      <ul>
        <li>
<a>Verification method</a> revocation is a reactive security measure.
        </li>

        <li>
It is considered a best practice to support key revocation.
        </li>

        <li>
A <a>controller</a> is expected to immediately revoke any <a>verification
method</a> that is known to be compromised.
        </li>

        <li>
<a>Verification method</a> revocation can only be embodied in changes to
the latest version of a <a>controller document</a>; it cannot retroactively adjust
previous versions.
        </li>

        <li>
If a <a>verification method</a> is no longer exclusively accessible to the
<a>controller</a> or parties trusted to act on behalf of the <a>controller</a>,
it is expected to be revoked immediately to reduce the risk of
compromises such as masquerading, theft, and fraud.
        </li>

        <li>
Revocation is expected to be understood as a <a>controller</a> expressing that
proofs or signatures associated with a revoked <a>verification method</a>
created after its revocation should be treated as invalid. It could also imply a
concern that existing proofs or signatures might have been created by an
attacker, but this is not necessarily the case. Verifiers, however, might still
choose to accept or reject any such proofs or signatures at their own
discretion.
        </li>

        <li>
Even if a <a>verification method</a> is present in a <a>controller document</a>,
additional information, such as a public key revocation certificate, or an
external allow or deny list, could be used to determine whether a
<a>verification method</a> has been revoked.
        </li>

        <li>
The day-to-day operation of any software relying on a compromised
<a>verification method</a>, such as an individual's operating system, antivirus,
or endpoint protection software, could be impacted when the <a>verification
method</a> is publicly revoked.
        </li>
      </ul>

      <section class="notoc">
        <h3>Revocation Semantics</h3>

        <p>
Although verifiers might choose not to accept proofs or signatures from a
revoked verification method, knowing whether a verification was made with a
revoked <a>verification method</a> is trickier than it might seem. Some auditing
systems provide the ability to look back at the state of an identifier at a
point in time, or at a particular version of the <a>controller document</a>.
When such a feature is combined with a reliable way to determine the time or
identifier version that existed when a cryptographically verifiable statement
was made, then revocation does not undo that statement. This can be the basis
for using digital signatures to make binding commitments; for example, to sign
a mortgage.
        </p>
        <p>
If these conditions are met, revocation is not retroactive; it only nullifies
future use of the method.
        </p>
        <p>
However, in order for such semantics to be safe, the second condition &mdash; an
ability to know what the state of the <a>controller document</a> was at the time
the assertion was made &mdash; is expected to apply. Without that guarantee,
someone could discover a revoked key and use it to make cryptographically
verifiable statements with a simulated date in the past.
        </p>
        <p>
Some auditing systems only allow the retrieval of the current state of a
identifier. When this is true, or when the state of an identifier at the time of
a cryptographically verifiable statement cannot be reliably determined, then the
only safe course is to disallow any consideration of state with respect to time,
except the present moment. Identifier ecosystems that take this approach
essentially provide cryptographically verifiable statements as ephemeral tokens
that can be invalidated at any time by the <a>controller</a>.
        </p>
      </section>
    </section>

    <section>
      <h2>Immutability</h2>

      <p>
Many cybersecurity abuses hinge on exploiting gaps between reality and the
assumptions of rational, good-faith actors. Immutability of <a>controller documents</a>
can provide some security benefits. Individual <a>DID methods</a> ought to
consider constraints that would eliminate behaviors or semantics they do not
need. The more <em>locked down</em> a <a>DID method</a> is, while providing the
same set of features, the less it can be manipulated by malicious actors.
      </p>
      <p>
As an example, consider that a single edit to a <a>controller document</a> can change
anything except the root <code><a>id</a></code> property of the document. But
is it actually desirable for a <a>service</a> to change its
<code>type</code> after it is defined? Or for a key to change its value? Or
would it be better to require a new <code><a>id</a></code> when certain
fundamental properties of an object change? Malicious takeovers of a website
often aim for an outcome where the site keeps its host name identifier,
but is subtly changed underneath. If certain properties of the site, such
as the <a target="_blank"
href="https://en.wikipedia.org/wiki/Autonomous_system_(Internet)">ASN</a>
associated with its IP address, were required by the specification to be
immutable, anomaly detection would be easier, and attacks would be much
harder and more expensive to carry out.
      </p>
      <p>
For <a>DID methods</a> tied to a global source of truth, a direct,
just-in-time lookup of the latest version of a <a>controller document</a> is always
possible. However, it seems likely that layers of cache might eventually sit
between a <a>DID resolver</a> and that source of truth. If they do, believing
the attributes of an object in the <a>controller document</a> to have a given state
when they are actually subtly different might invite exploits. This is
particularly true if some lookups are of a full <a>controller document</a>, and
others are of partial data where the larger context is assumed.
      </p>
    </section>

    <section>
      <h2>Encrypted Data in Controller Documents</h2>
      <p>
Encryption algorithms have been known to fail due to advances in cryptography
and computing power. Implementers are advised to assume that any encrypted data
placed in a <a>controller document</a> might eventually be made available in clear text
to the same audience to which the encrypted data is available. This is
particularly pertinent if the <a>controller document</a> is public.
      </p>
      <p>
Encrypting all or parts of a <a>controller document</a> is <em>not</em> an appropriate
means to protect data in the long term. Similarly, placing encrypted data in
a <a>controller document</a> is not an appropriate means to protect personal data.
      </p>
      <p>
Given the caveats above, if encrypted data is included in a <a>controller document</a>,
implementers are advised to not associate any correlatable information
that could be used to infer a relationship between the encrypted data
and an associated party. Examples of correlatable information include
public keys of a receiving party, identifiers to digital assets known to be
under the control of a receiving party, or human readable descriptions of a
receiving party.
      </p>

    </section>

    <section>
      <h2>Equivalence Properties</h2>
      <p>
Given the <code><a>equivalentId</a></code> and <code><a>canonicalId</a></code>
properties are generated by <a>DID methods</a> themselves, the same security and
accuracy guarantees that apply to the resolved identifier present in the
<code>id</code> field of a <a>controller document</a> also apply to these properties.
The <code><a>alsoKnownAs</a></code> property is not guaranteed to be an accurate
statement of equivalence, and should not be relied upon without performing
validation steps beyond the resolution of the <a>controller document</a>.
      </p>
      <p>
The <code><a>equivalentId</a></code> and <code><a>canonicalId</a></code>
properties express equivalence assertions to variants of a single identifier
produced by the same <a>DID method</a> and can be trusted to the extent the
requesting party trusts the <a>DID method</a> and a conforming producer and
resolver.
      </p>
      <p>
The <code><a>alsoKnownAs</a></code> property permits an equivalence assertion to
<a>URIs</a> that are not governed by the same <a>DID method</a> and cannot be
trusted without performing verification steps outside of the governing <a>DID
method</a>. See additional guidance in <a href="#also-known-as"></a>.
      </p>
      <p>
As with any other security-related properties in the <a>controller document</a>,
parties relying on any equivalence statement in a <a>controller document</a> should
guard against the values of these properties being substituted by an attacker
after the proper verification has been performed. Any write access to a <a>DID
document</a> stored in memory or disk after verification has been performed is
an attack vector that might circumvent verification unless the <a>DID
document</a> is re-verified.
      </p>

    </section>

    <section>
      <h2>Content Integrity Protection</h2>
      <p>
<a>controller documents</a> which include links to external machine-readable content
such as images, web pages, or schemas are vulnerable to tampering. It is
strongly advised that external links are integrity protected using solutions
such as a hashlink [[?HASHLINK]]. External links are to be avoided if they
cannot be integrity protected and the <a>controller document</a>'s integrity is
dependent on the external link.
      </p>
      <p>
One example of an external link where the integrity of the <a>controller document</a>
itself could be affected is the JSON-LD Context [[JSON-LD11]]. To protect
against compromise, <a>controller document</a> consumers are advised to cache local
static copies of JSON-LD contexts and/or verify the integrity of external
contexts against a cryptographic hash that is known to be associated with a safe
version of the external JSON-LD Context.
      </p>
    </section>
    <section>
      <h2>Persistence</h2>
      <p>
<a>DIDs</a> are designed to be persistent such that a <a>controller</a> need not
rely upon a single trusted third party or administrator to maintain their
identifiers. In an ideal case, no administrator can take control away from the
<a>controller</a>, nor can an administrator prevent their identifiers' use for
any particular purpose such as authentication, authorization, and attestation.
No third party can act on behalf of a <a>controller</a> to remove or render
inoperable an entity's identifier without the <a>controller</a>'s consent.
      </p>
      <p>
However, it is important to note that in all <a>DID methods</a> that enable
cryptographic proof-of-control, the means of proving control can always be
transferred to another party by transferring the secret cryptographic material.
Therefore, it is vital that systems relying on the persistence of an identifier
over time regularly check to ensure that the identifier is, in fact, still under
the control of the intended party.
      </p>
      <p>
Unfortunately, it is impossible to determine from the cryptography alone whether
or not the secret cryptographic material associated with a given
<a>verification method</a> has been compromised. It might well be that the
expected <a>controller</a> still has access to the secret cryptographic material
&mdash; and as such can execute a proof-of-control as part of a verification
process &mdash; while at the same time, a bad actor also has access to those
same keys, or to a copy thereof.
      </p>
      <p>
As such, cryptographic proof-of-control is expected to only be used as one
factor in evaluating the level of identity assurance required for high-stakes
scenarios. identifier-based authentication provides much greater assurance than
a username and password, thanks to the ability to determine control over a
cryptographic secret without transmitting that secret between systems. However,
it is not infallible. Scenarios that involve sensitive, high value, or
life-critical operations are expected to use additional factors as appropriate.
      </p>
      <p>
In addition to potential ambiguity from use by different <a>controllers</a>, it
is impossible to guarantee, in general, that a given identifier is being used in
reference to the same subject at any given point in time. It is technically
possible for the controller to reuse an identifier for different subjects and,
more subtly, for the precise definition of the subject to either change over
time or be misunderstood.
      </p>
      <p>
For example, consider an identifier used for a sole proprietorship, receiving
various credentials used for financial transactions. To the <a>controller</a>,
that identifier referred to the business. As the business grows, it eventually
gets incorporated as a Limited Liability Company. The <a>controller</a>
continues using that same identifier, because to <strong>them</strong> the
identifier refers to the business. However, to the state, the tax authority, and
the local municipality, the identifier no longer refers to the same entity.
Whether or not the subtle shift in meaning matters to a credit provider or
supplier is necessarily up to them to decide. In many cases, as long as the
bills get paid and collections can be enforced, the shift is immaterial.
      </p>
      <p>
Due to these potential ambiguities, <a>DIDs</a> are to be considered valid
<em>contextually</em> rather than absolutely. Their persistence does not imply
that they refer to the exact same subject, nor that they are under the control
of the same <a>controller</a>. Instead, one needs to understand the context in
which the identifier was created, how it is used, and consider the likely shifts
in their meaning, and adopt procedures and policies to address both potential
and inevitable semantic drift.
      </p>
    </section>

    <section>
      <h2>Level of Assurance</h2>

      <p>
Additional information about the security context of authentication events is
often required for compliance reasons, especially in regulated areas such as the
financial and public sectors. This information is often referred to as a Level
of Assurance (LOA). Examples include the protection of secret cryptographic
material, the identity proofing process, and the form-factor of the
authenticator.
      </p>

      <p>
<a target="_blank"
href="https://ec.europa.eu/info/law/payment-services-psd-2-directive-eu-2015-2366_en">
Payment services (PSD 2)</a> and <a target="_blank"
href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=uriserv:OJ.L_.2014.257.01.0073.01.ENG">
eIDAS</a> introduce such requirements to the security context. Level of
assurance frameworks are classified and defined by regulations and
standards such as <a
target="_blank"
href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=uriserv:OJ.L_.2014.257.01.0073.01.ENG">
eIDAS</a>, <a target="_blank"
href="https://pages.nist.gov/800-63-3/sp800-63-3.html"> NIST 800-63-3</a> and <a
target="_blank" href="https://www.iso.org/standard/45138.html"> ISO/IEC
29115:2013</a>, including their requirements for the security context, and
making recommendations on how to achieve them. This might include strong user
authentication where <a target="_blank"
href="https://fidoalliance.org/fido2/">FIDO2</a>/<a target="_blank"
href="https://www.w3.org/TR/webauthn-2/">WebAuthn</a> can fulfill the
requirement.
      </p>

      <p>
Some regulated scenarios require the implementation of a specific level of
assurance. Since <a>verification relationships</a> such as <code>
<a>assertionMethod</a></code> and <code><a>authentication</a></code> might be
used in some of these situations, information about the applied security context
might need to be expressed and provided to a <em>verifier</em>. Whether and how
to encode this information in the <a>controller document</a> data model is out of scope
for this specification. Interested readers might note that 1) the information
could be transmitted using Verifiable Credentials [[?VC-DATA-MODEL]], and 2) the
<a>controller document</a> data model can be extended to incorporate this information
as described in <a href="#extensibility"></a>, and where <a
href="#privacy-considerations"></a> is applicable for such extensions.
      </p>
    </section>
  </section>

  <section class="informative">
    <h1>Privacy Considerations</h1>

    <p>
Since <a>DIDs</a> and <a>controller documents</a> are designed to be administered
directly by the <a>DID controller(s)</a>, it is critically important to apply
the principles of Privacy by Design [[PRIVACY-BY-DESIGN]] to all aspects of the
<a>decentralized identifier</a> architecture. All seven of these principles
have been applied throughout the development of this specification. The design
used in this specification does not assume that there is a registrar, hosting
company, nor other intermediate service provider to recommend or apply
additional privacy safeguards. Privacy in this specification is preventive,
not remedial, and is an embedded default. The following sections cover privacy
considerations that implementers might find useful when building systems that
utilize <a>decentralized identifiers</a>.
    </p>

    <section>
      <h2>Keep Personal Data Private</h2>

      <p>
If a <a>DID method</a> specification is written for a public-facing
<a>verifiable data registry</a> where corresponding <a>DIDs</a> and <a>DID
documents</a> might be made publicly available, it is <em>critical</em> that
those <a>controller documents</a> contain no personal data. Personal data can instead
be transmitted through other means such as 1) Verifiable Credentials
[[?VC-DATA-MODEL]], or 2) <a>service endpoints</a> under control of the <a>DID
subject</a> or <a>DID controller</a>.
      </p>

      <p>
Due diligence is expected to be taken around the use of URLs in <a>service
endpoints</a> to prevent leakage of personal data or correlation within a URL of
a <a>service endpoint</a>. For example, a URL that contains a username is
dangerous to include in a <a>controller document</a> because the username is likely to
be human-meaningful in a way that can reveal information that the <a>DID
subject</a> did not consent to sharing. With the privacy architecture suggested
by this specification, personal data can be exchanged on a private, peer-to-peer
basis using communication channels identified and secured by <a>verification
methods</a> in <a>controller documents</a>. This also enables <a>DID subjects</a> and
requesting parties to implement the <a
href="https://en.wikipedia.org/wiki/General_Data_Protection_Regulation">GDPR</a>
<a href="https://en.wikipedia.org/wiki/Right_to_be_forgotten">right to be
forgotten</a>, because no personal data is written to an immutable
<a>distributed ledger</a>.
      </p>
    </section>

    <section>
      <h2>DID Correlation Risks</h2>

      <p>
Like any type of globally unambiguous identifier, <a>DIDs</a> might be used for
correlation. <a>DID controllers</a> can mitigate this privacy risk by using
pairwise <a>DIDs</a> that are unique to each relationship; in effect, each
identifier acts as a pseudonym. A pairwise identifier need only be shared with
more than one party when correlation is explicitly desired. If pairwise
<a>DIDs</a> are the default, then the only need to publish an identifier openly,
or to share it with multiple parties, is when the <a
href="#dfn-did-controllers">DID controller(s)</a> and/or <a>DID subject</a>
explicitly desires public identification and correlation.
      </p>
    </section>

    <section>
      <h2>Controller Document Correlation Risks</h2>

      <p>
The anti-correlation protections of pairwise <a>DIDs</a> are easily defeated if
the data in the corresponding <a>controller documents</a> can be correlated. For
example, using identical <a>verification methods</a> or bespoke <a>service
endpoints</a> in multiple <a>controller documents</a> can provide as much correlation
information as using the same identifier. Therefore, the <a>controller document</a> for
a pairwise identifier also needs to use pairwise unique information, such as
ensuring that <a>verification methods</a> are unique to the pairwise
relationship.
      </p>

      <p>
It might seem natural to also use pairwise unique <a>service endpoints</a> in
the <a>controller document</a> for a pairwise identifier. However, unique endpoints
allow all traffic between two <a>DIDs</a> to be isolated perfectly into unique
buckets, where timing correlation and similar analysis is easy. Therefore, a
better strategy for endpoint privacy might be to share an endpoint among a large
number of <a>DIDs</a> controlled by many different subjects (see <a
href="#herd-privacy"></a>).
      </p>
    </section>

    <section>
      <h2>DID Subject Classification</h2>
      <p>
It is dangerous to add properties to the <a>controller document</a> that can be used
to indicate, explicitly or through inference, what <em>type</em> or nature of
thing the <a>DID subject</a> is, particularly if the <a>DID subject</a> is a
person.
      </p>
      <p>
Not only do such properties potentially result in personal data (see
<a href="#keep-personal-data-private"></a>) or
correlatable data (see <a href="#did-correlation-risks">
</a> and <a href="#did-document-correlation-risks"></a>) being present in the
<a>controller document</a>, but they can be used for grouping particular <a>DIDs</a>
in such a way that they are included in or excluded from certain operations or
functionalities.
      </p>
      <p>
Including <em>type</em> information in a <a>controller document</a> can
result in personal privacy harms even for <a>DID Subjects</a> that are
non-person entities, such as IoT devices. The aggregation of such
information around a <a>DID Controller</a> could serve as a form of
digital fingerprint and this is best avoided.
      </p>
      <p>
To minimize these risks, all properties in a <a>controller document</a> ought to be
for expressing cryptographic material, endpoints, or <a>verification methods</a>
related to using the identifier.
      </p>

    </section>

    <section>
      <h2>Herd Privacy</h2>

      <p>
When a <a>DID subject</a> is indistinguishable from others in the herd,
privacy is available. When the act of engaging privately with another party is
by itself a recognizable flag, privacy is greatly diminished.
      </p>
      <p>
<a>DIDs</a> and <a>DID
methods</a> need to work to improve herd privacy, particularly for those who
legitimately need it most. Choose technologies and human interfaces that
default to preserving anonymity and pseudonymity. To reduce <a
href="https://en.wikipedia.org/wiki/Device_fingerprint">digital
fingerprints</a>, share common settings across requesting party
implementations, keep negotiated options to a minimum on wire protocols, use
encrypted transport layers, and pad messages to standard lengths.
      </p>
    </section>

    <section>
      <h2>Service Privacy</h2>
      <p>
The ability for a <a>controller</a> to optionally express at least one
<a>service endpoint</a> in the <a>controller document</a> increases their control and
agency. Each additional endpoint in the <a>controller document</a> adds privacy risk
either due to correlation, such as across endpoint descriptions, or because the
<a>services</a> are not protected by an authorization mechanism, or both.
      </p>
      <p>
<a>controller documents</a> are often public and, since they are standardized, will be
stored and indexed efficiently by their very standards-based nature. This risk
is worse if <a>controller documents</a> are published to immutable <a>verifiable data
registries</a>. Access to a history of the <a>controller documents</a> referenced by a
identifier represents a form of traffic analysis made more efficient through the
use of standards.
      </p>
      <p>
The degree of additional privacy risk caused by using multiple <a>service
endpoints</a> in one <a>controller document</a> can be difficult to estimate. Privacy
harms are typically unintended consequences. <a>DIDs</a> can refer to documents,
<a>services</a>, schemas, and other things that might be associated with
individual people, households, clubs, and employers &mdash; and correlation of
their <a>service endpoints</a> could become a powerful surveillance and
inference tool. An example of this potential harm can be seen when multiple
common country-level top level domains such as
<code>https://example.co.uk</code> might be used to infer the approximate
location of the <a>DID subject</a> with a greater degree of probability.
      </p>

      <section class="notoc">
        <h3>Maintaining Herd Privacy</h3>
        <p>
The variety of possible endpoints makes it particularly challenging to maintain
herd privacy, in which no information about the <a>DID subject</a> is leaked
(see <a href="#herd-privacy"></a>).
        </p>

        <p>
First, because service endpoints might be specified as <a>URIs</a>, they could
unintentionally leak personal information because of the architecture of the
service. For example, a service endpoint of
<code>http://example.com/MyFirstName</code> is leaking the term
<code>MyFirstName</code> to everyone who can access the <a>controller document</a>.
When linking to legacy systems, this is an unavoidable risk, and care is
expected to be taken in such cases. This specification encourages new,
identifier-aware endpoints to use nothing more than the identifier itself for
any identification necessary. For example, if a service description were to
include <code>http://example.com/did%3Aexample%3Aabc123</code>, no harm would be
done because <code>did:example:abc123</code> is already exposed in the DID
Document; it leaks no additional information.
        </p>

        <p>
Second, because a <a>controller document</a> can list multiple service endpoints, it is
possible to irreversibly associate services that are not associated in any other
context. This correlation on its own may lead to privacy harms by revealing
information about the <a>DID subject</a>, even if the <a>URIs</a> used did not
contain any sensitive information.
        </p>
        <p>
Third, because some types of <a>DID subjects</a> might be more or less likely to
list specific endpoints, the listing of a given service could, by itself, leak
information that can be used to infer something about the <a>DID subject</a>.
For example, an identifier for an automobile might include a pointer to a public
title record at the Department of Motor Vehicles, while an identifier for an
individual would not include that information.
        </p>
        <p>
It is the goal of herd privacy to ensure that the nature of specific <a>DID
subjects</a> is obscured by the population of the whole. To maximize herd
privacy, implementers need to rely on one &mdash; and only one &mdash; service
endpoint, with that endpoint providing a proxy or mediator service that the
controller is willing to depend on, to protect such associations and to blind
requests to the ultimate service.
        </p>
      </section>

      <section class="notoc">
        <h3>Service Endpoint Alternatives</h3>

        <p>
Given the concerns in the previous section, implementers are urged to
consider any of the following service endpoint approaches:
        </p>

        <ul>
          <li>
<strong>Negotiator Endpoint</strong> &mdash; Service for negotiating mutually
agreeable communications channels, preferably using private set intersection.
The output of negotiation is a communication channel and whatever credentials
might be needed to access it.
          </li>
          <li>
<strong>Tor Endpoint</strong> (<a
href="https://www.torproject.org/about/history/">Tor Onion Router</a>) &mdash;
Provide a privacy-respecting address for reaching service endpoints. Any service
that can be provided online can be provided through TOR for additional
privacy.
           </li>
           <li>
<strong>Mediator Endpoint</strong> &mdash; <a
href="https://github.com/hyperledger/aries-rfcs/blob/720bdab50e2d0437fda03028c1b17c69781bdd69/concepts/0046-mediators-and-relays/README.md">Mediators</a>
provide a generic endpoint, for multiple parties, receive encrypted messages on
behalf of those parties, and forward them to the intended recipient. This avoids
the need to have a specific endpoint per subject, which could create a
correlation risk. This approach is also called a proxy.
          </li>
          <li>
<strong>Confidential Storage</strong> &mdash; Proprietary or confidential
personal information might need to be kept off of a <a>verifiable data
registry</a> to provide additional privacy and/or security guarantees,
especially for those <a>DID methods</a> where <a>controller documents</a> are published
on a public ledger. Pointing to external resource services provides a means for
authorization checks and deletion.
          </li>
          <li>
<strong>Polymorphic Proxy</strong> &mdash; A proxy endpoint that can act as any
number of services, depending on how it is called. For example, the same URL
could be used for both negotiator and mediator functions, depending on a
mechanism for re-routing.
          </li>
        </ul>

        <p>
These service endpoint types continue to be an area of innovation and
exploration.
        </p>
      </section>
    </section>
    </section>

    <section class="informative">
      <h2>Revision History</h2>

      <p>
This section contains the substantive changes that have been made to this
specification over time.
      </p>

      <ul>
        <li>
Populated Terminology section.
        </li>
        <li>
Apply wording updates from VC-JOSE-COSE spec.
        </li>
      </ul>

    </section>
    <section class="informative">
      <h2>Acknowledgements</h2>

      <p>
The specification authors would like to thank the contributors to the
W3C Decentralized Identifiers (DIDs) v1.0,
W3C Verifiable Credential Data Integrity 1.0, and
W3C Securing Verifiable Credentials using JOSE and COSE specifications
upon which this work is based.
      </p>
  </body>
</html>
